# ğŸ• LLMì„ ì—°ë™í•œ ë‚´ì™¸ë¶€ ë¬¸ì„œ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ ì‹œìŠ¤í…œ

**ê°•ì•„ì§€ ì§ˆë³‘ ì¦ìƒ ìƒë‹´ ì±—ë´‡**

ğŸ‘¥ íŒ€ì› ì†Œê°œ

<div align="center">
<table>
  <tr>
    <td align="center" width="150" style="vertical-align: top; padding: 10px;">
      <img src="https://github.com/user-attachments/assets/85e707e3-380e-4b47-a530-cc593bcd4f87" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
      <div style="margin-top: 8px;">
        <b>ë°•ì°¬</b><br>íŒ€ì¥
      </div>
    </td>
    <td align="center" width="150" style="vertical-align: top; padding: 10px;">
      <img src="https://github.com/user-attachments/assets/40307edb-2139-4c87-923a-a18ce394f5b0" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
      <div style="margin-top: 8px;">
        <b>ê¹€ë‚˜í˜„</b><br>íŒ€ì›
      </div>
    </td>
    <td align="center" width="150" style="vertical-align: top; padding: 10px;">
      <img src="https://github.com/user-attachments/assets/806b67c5-b5a0-4605-868b-bf52895bc006" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
      <div style="margin-top: 8px;">
        <b>ì´ë„ê²½</b><br>íŒ€ì›
      </div>
    </td>
    <td align="center" width="150" style="vertical-align: top; padding: 10px;">
      <img src="https://github.com/user-attachments/assets/5c1c0ded-8509-412e-9d51-46d8bd9e7c11" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
      <div style="margin-top: 8px;">
        <b>ì•ˆì±„ì—°</b><br>íŒ€ì›
      </div>
    </td>
    <td align="center" width="150" style="vertical-align: top; padding: 10px;">
      <img src="https://github.com/user-attachments/assets/334057f7-b2a3-4fac-919c-d78ade2be0fe" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px;">
      <div style="margin-top: 8px;">
        <b>ì´ê²½í˜„</b><br>íŒ€ì›
      </div>
    </td>
  </tr>
</table>
</div>

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”

### **ê°•ì•„ì§€ ì§ˆë³‘ ì¦ìƒ ì±—ë´‡**

ë°˜ë ¤ê²¬ ë³´í˜¸ìê°€ ê°•ì•„ì§€ì˜ ì¦ìƒì„ ì…ë ¥í•˜ë©´, AIê°€ ìˆ˜ì˜í•™ ì§€ì‹ ë°ì´í„°ë² ì´ìŠ¤ì™€ ê³¼ê±° ìƒë‹´ ê¸°ë¡ì„ ê¸°ë°˜ìœ¼ë¡œ ì •í™•í•œ ì˜ë£Œì •ë³´ë¥¼ ì œê³µí•˜ëŠ” RAG ê¸°ë°˜ Chat-botì…ë‹ˆë‹¤.

### **ì£¼ìš” íŠ¹ì§•**
- ğŸ“š **30,000+ ê±´ì˜ ìˆ˜ì˜í•™ ë°ì´í„°** ê¸°ë°˜ ì •í™•í•œ ë‹µë³€
- ğŸ” **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì‹œìŠ¤í…œ** (Similarity + BM25 + Ensemble(Simlilarity + BM25))
- ğŸ¯ **RAGAS ê¸°ë°˜ ì„±ëŠ¥ í‰ê°€** (4ê°€ì§€ ë©”íŠ¸ë¦­ìœ¼ë¡œ ê°ê´€ì  í’ˆì§ˆ ì¸¡ì •)
- ğŸ’¬ **Streamlit ê¸°ë°˜ ì§ê´€ì ì¸ UI**
- ğŸ¤– **ë‹¤ì¤‘ ì„ë² ë”© ëª¨ë¸ ë¹„êµ** (OpenAI vs BGE-M3)
- ğŸ“Š **ì²´ê³„ì ì¸ í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ìƒì„± ë° í‰ê°€**

---

## ğŸ¯ ê°œë°œ ë™ê¸°

### **ë¬¸ì œ ì¸ì‹**
1. **ì •ë³´ ì ‘ê·¼ì„± ë¬¸ì œ**: ë°˜ë ¤ê²¬ ë³´í˜¸ìë“¤ì´ ì¦ìƒ ë°œìƒ ì‹œ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¥¼ ì°¾ê¸° ì–´ë ¤ì›€
2. **ì‘ê¸‰ ìƒí™© íŒë‹¨ ì–´ë ¤ì›€**: ì–´ë–¤ ì¦ìƒì´ ì‘ê¸‰ì¸ì§€, ì–¸ì œ ë³‘ì›ì— ê°€ì•¼ í•˜ëŠ”ì§€ íŒë‹¨ì´ ì–´ë ¤ì›€
3. **ê²€ìƒ‰ ì„±ëŠ¥ì˜ ë¶ˆí™•ì‹¤ì„±**: ë‹¨ì¼ ê²€ìƒ‰ ë°©ì‹ìœ¼ë¡œëŠ” ë‹¤ì–‘í•œ ì§ˆë¬¸ ìœ í˜•ì— ëŒ€ì‘í•˜ê¸° ì–´ë ¤ì›€

### **í•´ê²° ë°©ì•ˆ**
- **LLM + RAG ê¸°ìˆ **ì„ í™œìš©í•˜ì—¬ ìˆ˜ì˜í•™ ì „ë¬¸ ì§€ì‹ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ì •í™•í•œ ìƒë‹´ ì œê³µ
- **ë‹¤ë‹¨ê³„ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**ìœ¼ë¡œ ê´€ë ¨ì„± ë†’ì€ ì •ë³´ë§Œ ì„ ë³„í•˜ì—¬ í• ë£¨ì‹œë„¤ì´ì…˜ ìµœì†Œí™”
- **RAGAS í‰ê°€ í”„ë ˆì„ì›Œí¬**ë¡œ ì‹œìŠ¤í…œ ì„±ëŠ¥ì„ ê°ê´€ì ìœ¼ë¡œ ì¸¡ì • ë° ê°œì„ 

---

## âš¡ ì£¼ìš” ê¸°ëŠ¥

### 1. **ì¦ìƒ ê¸°ë°˜ ì§ˆì˜ì‘ë‹µ**
- ë°˜ë ¤ê²¬ì˜ ì¦ìƒì„ ìì—°ì–´ë¡œ ì…ë ¥í•˜ë©´ AIê°€ ChromaDBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬ ë‹µë³€ ì œê³µ
- ê°€ëŠ¥í•œ ì›ì¸, ì§‘ì—ì„œì˜ ê´€ë¦¬ ë°©ë²•, ë³‘ì› ë°©ë¬¸ ì‹œê¸° ë“±ì„ ì¢…í•©ì ìœ¼ë¡œ ì•ˆë‚´
- ëª¨ë“  ë‹µë³€ì— ì¶œì²˜ ì •ë³´ ëª…ì‹œ (ì„œì , ìƒë‹´ê¸°ë¡ ë“±)

### 2. **í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ ì‹œìŠ¤í…œ**
```
ê²€ìƒ‰ ë°©ì‹ 4ê°€ì§€ ì œê³µ:

1. Similarity Search (ìœ ì‚¬ë„ ê²€ìƒ‰)
   â””â”€ ë²¡í„° ìœ ì‚¬ë„ ê¸°ë°˜ ì˜ë¯¸ë¡ ì  ê²€ìƒ‰

2. BM25 Search (í‚¤ì›Œë“œ ê²€ìƒ‰)
   â””â”€ ì „í†µì ì¸ í‚¤ì›Œë“œ ë§¤ì¹­ ê¸°ë°˜
   â””â”€ TF-IDF ê°œì„  ì•Œê³ ë¦¬ì¦˜

3. Ensemble Search (ì•™ìƒë¸”)
   â””â”€ Similarity + BM25 ê²°í•©
   â””â”€ ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì¢…í•© ê²€ìƒ‰ (0.5:0.5)
```

### 3. **Query Rewriting (ì§ˆë¬¸ ë³€í™˜)**
```python
# ì‚¬ìš©ì ì§ˆë¬¸ì„ ê²€ìƒ‰ì— ìµœì í™”ëœ í‚¤ì›Œë“œë¡œ ë³€í™˜
ì›ë³¸: "ê°•ì•„ì§€ê°€ ë°¥ì„ ì˜ ì•ˆ ë¨¹ê³  ê³„ì† í† í•´ìš”"
ë³€í™˜: "ê°•ì•„ì§€ ì‹ìš•ë¶€ì§„ êµ¬í† "
```

### 4. **ë‹¤ì¤‘ ì„ë² ë”© ëª¨ë¸ ì§€ì›**
- **OpenAI Embeddings**: `text-embedding-3-small` (1536ì°¨ì›)
- **BGE-M3**: `BAAI/bge-m3` (ë‹¤êµ­ì–´ ì§€ì›, ë¬´ë£Œ)
- ê° ëª¨ë¸ë³„ ë…ë¦½ì ì¸ ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶• ë° ì„±ëŠ¥ ë¹„êµ

### 5. **RAGAS ê¸°ë°˜ ì„±ëŠ¥ í‰ê°€**
```
í‰ê°€ ì§€í‘œ (RAGAS 4ëŒ€ ë©”íŠ¸ë¦­):

1. Context Recall (ê²€ìƒ‰ ì¬í˜„ìœ¨)
   â””â”€ ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì •ë‹µì„ ì–¼ë§ˆë‚˜ í¬í•¨í•˜ëŠ”ê°€?

2. Context Precision (ê²€ìƒ‰ ì •í™•ë„)
   â””â”€ ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì–¼ë§ˆë‚˜ ê´€ë ¨ì„±ì´ ë†’ì€ê°€?

3. Faithfulness (ì¶©ì‹¤ì„±)
   â””â”€ ë‹µë³€ì´ ê²€ìƒ‰ëœ ë¬¸ì„œì— ê¸°ë°˜í•˜ëŠ”ê°€? (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€)

4. Answer Relevancy (ë‹µë³€ ê´€ë ¨ì„±)
   â””â”€ ë‹µë³€ì´ ì§ˆë¬¸ê³¼ ê´€ë ¨ì´ ìˆëŠ”ê°€?
```

### 6. **í•©ì„± í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ìƒì„±**
- RAGASë¥¼ í™œìš©í•œ ê³ í’ˆì§ˆ í…ŒìŠ¤íŠ¸ ë°ì´í„° ìë™ ìƒì„±
- ë²¡í„°ìŠ¤í† ì–´ì˜ ì‹¤ì œ ë¬¸ì„œ ê¸°ë°˜ìœ¼ë¡œ ì§ˆë¬¸-ë‹µë³€ ìŒ ìƒì„±
- ë‹¤ì–‘í•œ ì§ˆë¬¸ ìœ í˜• ì§€ì› (simple, reasoning, multi_context, conditional)

---

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤                        â”‚
â”‚                        (Streamlit UI)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ì§ˆì˜ ì‘ë‹µ ì‹œìŠ¤í…œ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚    Query     â”‚â”€â–¶â”‚  Retriever   â”‚â”€â–¶â”‚    LLM    â”‚         â”‚
â”‚  â”‚  Rewriting   â”‚  â”‚              â”‚  â”‚ (GPT-4o   â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  -mini)   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                 â”‚               â”‚
â”‚         â–¼                 â–¼                 â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   Keyword    â”‚  â”‚ Similarity   â”‚  â”‚  Prompt   â”‚         â”‚
â”‚  â”‚  Extraction  â”‚  â”‚     BM25     â”‚  â”‚ Template  â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  Ensemble    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       ë°ì´í„° ë ˆì´ì–´                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚    ChromaDB      â”‚  â”‚    ChromaDB      â”‚                â”‚
â”‚  â”‚    (OpenAI)      â”‚  â”‚    (BGE-M3)      â”‚                â”‚
â”‚  â”‚  30,000+ docs    â”‚  â”‚  30,000+ docs    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                              â”‚
â”‚          - ìˆ˜ì˜í•™ ì„œì  ë°ì´í„° (5ê°œ ê³¼)                        â”‚
â”‚          - ì§ˆì˜ì‘ë‹µ ë°ì´í„° (5ê°œ ê³¼)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       í‰ê°€ ì‹œìŠ¤í…œ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚      RAGAS       â”‚  â”‚  Test Dataset    â”‚                â”‚
â”‚  â”‚   Evaluation     â”‚â—„â”€â”‚   Generation     â”‚                â”‚
â”‚  â”‚   (4 Metrics)    â”‚  â”‚   (Synthetic)    â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **í•µì‹¬ ì»´í¬ë„ŒíŠ¸**

#### 1. **ë°ì´í„° ì „ì²˜ë¦¬ ëª¨ë“ˆ** (`preprocessing.py`)
- ìˆ˜ì˜í•™ ì„œì  ë°ì´í„°ì™€ QA ë°ì´í„° í†µí•© ì²˜ë¦¬
- ë°ì´í„° íƒ€ì…ë³„ ì°¨ë³„í™”ëœ ì²­í‚¹ ì „ëµ
  - **ì˜í•™ ë°ì´í„°**: `chunk_size=500`, `chunk_overlap=100`
  - **QA ë°ì´í„°**: `chunk_size=800`, `chunk_overlap=50`
- ë©”íƒ€ë°ì´í„° êµ¬ì¡°í™” (ì¶œì²˜, ì§„ë£Œê³¼, ìƒì• ì£¼ê¸° ë“±)

#### 2. **ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶•**
- **OpenAI ë²¡í„°ìŠ¤í† ì–´** (`vectorstore_openai.py` - ë³„ë„ íŒŒì¼)
  - ì„ë² ë”©: `text-embedding-3-small`
  - ì»¬ë ‰ì…˜: `pet_health_qa_system`
  - ê²½ë¡œ: `../data/ChromaDB_openai`

- **BGE-M3 ë²¡í„°ìŠ¤í† ì–´** (`vectorstore_bge_m3.py`)
  - ì„ë² ë”©: `BAAI/bge-m3`
  - ì»¬ë ‰ì…˜: `pet_health_qa_system_bge_m3`
  - ê²½ë¡œ: `../data/ChromaDB_bge_m3`

- ë°°ì¹˜ ì²˜ë¦¬ (100ê°œì”©)ë¡œ ëŒ€ìš©ëŸ‰ ë°ì´í„° íš¨ìœ¨ì  ì„ë² ë”©
- API Rate Limit ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ (time.sleep í¬í•¨)

#### 3. **Retriever ì‹œìŠ¤í…œ** (`ensemble.py`)
```python
class EnsembleRetriever:
    """ì—¬ëŸ¬ retrieverì˜ ê²°ê³¼ë¥¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ê²°í•©í•˜ëŠ” ì•™ìƒë¸” ë¦¬íŠ¸ë¦¬ë²„"""
    
    def __init__(self, retrievers: List, weights: List[float]):
        self.retrievers = retrievers  # [vector_retriever, bm25_retriever]
        self.weights = weights         # [0.5, 0.5]
    
    def invoke(self, query: str) -> List[Document]:
        """ì—¬ëŸ¬ retrieverì˜ ê²°ê³¼ë¥¼ ê°€ì¤‘ì¹˜ ê¸°ë°˜ìœ¼ë¡œ ê²°í•©"""
        all_docs = []
        doc_scores = {}
        
        for retriever, weight in zip(self.retrievers, self.weights):
            docs = retriever.invoke(query)
            
            # ê° ë¬¸ì„œì— ê°€ì¤‘ì¹˜ ì ìš© (ìˆœìœ„ ê¸°ë°˜ ìŠ¤ì½”ì–´)
            for i, doc in enumerate(docs):
                doc_id = hash(doc.page_content)
                score = weight * (len(docs) - i) / len(docs)
                
                if doc_id in doc_scores:
                    doc_scores[doc_id]['score'] += score
                else:
                    doc_scores[doc_id] = {'doc': doc, 'score': score}
        
        # ìŠ¤ì½”ì–´ ê¸°ì¤€ìœ¼ë¡œ ì •ë ¬
        sorted_docs = sorted(doc_scores.values(), key=lambda x: x['score'], reverse=True)
        return [item['doc'] for item in sorted_docs]
```

#### 4. **í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ë° RAG ì‹œìŠ¤í…œ** (`prompt_module.py`)
- **í•µì‹¬ í•¨ìˆ˜ë“¤**:
  - `initialize_rag_system()`: RAG ì‹œìŠ¤í…œ ì´ˆê¸°í™” (ë²¡í„°ìŠ¤í† ì–´, LLM, retriever ë¡œë“œ)
  - `get_rag_prompt()`: RAG ë‹µë³€ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
  - `get_rewrite_prompt()`: ì§ˆë¬¸ ë³€í™˜ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
  - `format_docs()`: ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ XML í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
  - `filter_docs_by_response()`: ë‹µë³€ì— ì‹¤ì œë¡œ ì‚¬ìš©ëœ ë¬¸ì„œë§Œ í•„í„°ë§

- **í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€ ê·œì¹™** ëª…ì‹œ
  - ë¬¸ë§¥ì— ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ ì‚¬ìš© ê¸ˆì§€
  - ê´€ë ¨ ì •ë³´ ì—†ì„ ì‹œ ëª…í™•íˆ ì•ˆë‚´
  - ì‹¤ì œ ì‚¬ìš©í•œ ë¬¸ì„œë§Œ ì¶œì²˜ ëª…ì‹œ

- **êµ¬ì¡°í™”ëœ ë‹µë³€ í˜•ì‹**
  ```
  - ìƒíƒœ ìš”ì•½: (2~3ë¬¸ì¥)
  - ê°€ëŠ¥í•œ ì›ì¸: (ë¬¸ì„œ ê¸°ë°˜)
  - ì§‘ì—ì„œ ê´€ë¦¬ ë°©ë²•: (2~3ê°€ì§€)
  - ë³‘ì› ë°©ë¬¸ ì‹œê¸°: (ì‘ê¸‰ ì¦ìƒ í¬í•¨)
  - ì¶œì²˜: (ì„œì /ìƒë‹´ê¸°ë¡ ìƒì„¸ ì •ë³´)
  ```

#### 5. **í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±** (`make_testset.py` - ë³„ë„ íŒŒì¼)
```python
# ë²¡í„°ìŠ¤í† ì–´ì—ì„œ context ì¶”ì¶œ â†’ LLMìœ¼ë¡œ ì§ˆë¬¸-ë‹µë³€ ìƒì„±
1. ë²¡í„°ìŠ¤í† ì–´ì—ì„œ 10ê°œ context ëœë¤ ì¶”ì¶œ (ìµœì†Œ 200ì)
2. GPT-4o-minië¡œ ê° context ê¸°ë°˜ Q&A ìƒì„±
3. CSV í˜•ì‹ìœ¼ë¡œ ì €ì¥ (user_input, reference)
```

#### 6. **RAGAS í‰ê°€ ì‹œìŠ¤í…œ** 
- **OpenAI í‰ê°€** (`evaluate_openai.py` - ë³„ë„ íŒŒì¼)
  - OpenAI ë²¡í„°ìŠ¤í† ì–´ ì‚¬ìš©
  - 4ê°€ì§€ ê²€ìƒ‰ ë°©ì‹ ë¹„êµ
  - RAGAS 4ëŒ€ ë©”íŠ¸ë¦­ ì¸¡ì •
  - ê²°ê³¼ ì €ì¥: `ragas_evaluation_results_openai.csv`

- **BGE-M3 í‰ê°€** (`evaluate_bge_m3.py`)
  - BGE-M3 ë²¡í„°ìŠ¤í† ì–´ ì‚¬ìš©
  - ë™ì¼í•œ í‰ê°€ íŒŒì´í”„ë¼ì¸
  - ê²°ê³¼ ì €ì¥: `ragas_evaluation_results_bge_m3.csv`

#### 7. **í•©ì„± ë°ì´í„° ìƒì„±** (`ragas_synthetic_dataset.py` - ë³„ë„ íŒŒì¼)
```python
# RAGAS TestsetGenerator ì‚¬ìš©
distributions = {
    simple: 0.4,           # ê°„ë‹¨í•œ ì§ˆë¬¸
    reasoning: 0.2,        # ì¶”ë¡  í•„ìš”
    multi_context: 0.2,    # ì—¬ëŸ¬ ë§¥ë½
    conditional: 0.2       # ì¡°ê±´ë¶€ ì§ˆë¬¸
}

# 50ê°œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ìë™ ìƒì„±
testset = generator.generate_with_langchain_docs(
    documents=documents,
    test_size=50,
    distributions=distributions
)
```

---

## ğŸ”„ ë°ì´í„° íë¦„

### **ì „ì²´ í”„ë¡œì„¸ìŠ¤**

```
1. ë°ì´í„° ìˆ˜ì§‘ ë° ì „ì²˜ë¦¬
   â”œâ”€ ìˆ˜ì˜í•™ ì„œì  ë°ì´í„° (5ê°œ ê³¼ Ã— ìˆ˜ì²œ ê±´)
   â””â”€ ì§ˆì˜ì‘ë‹µ ë°ì´í„° (5ê°œ ê³¼ Ã— ìˆ˜ì²œ ê±´)
   â†“
2. ì²­í‚¹ (Chunking)
   â”œâ”€ ì˜í•™ ë°ì´í„°: 500ì ì²­í¬ (overlap 100)
   â””â”€ QA ë°ì´í„°: 800ì ì²­í¬ (overlap 50)
   â†“
3. ì„ë² ë”© ë° ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶•
   â”œâ”€ OpenAI: text-embedding-3-small
   â””â”€ BGE-M3: BAAI/bge-m3
   â†“
4. ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
   â†“
5. Query Rewriting (í‚¤ì›Œë“œ ì¶”ì¶œ)
   â†“
6. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ 
   â”œâ”€ Similarity Search   
   â”œâ”€ BM25 Search
   â””â”€ Ensemble Search
   â†“
7. ë¬¸ì„œ í¬ë§·íŒ… (ì¶œì²˜ ì •ë³´ í¬í•¨)
   â†“
8. LLM ë‹µë³€ ìƒì„± (GPT-4o-mini)
   â”œâ”€ ìƒíƒœ ìš”ì•½
   â”œâ”€ ê°€ëŠ¥í•œ ì›ì¸
   â”œâ”€ ì§‘ì—ì„œ ê´€ë¦¬ ë°©ë²•
   â”œâ”€ ë³‘ì› ë°©ë¬¸ ì‹œê¸°
   â””â”€ ì¶œì²˜ ëª…ì‹œ
   â†“
9. ë‹µë³€ì— ì‚¬ìš©ëœ ë¬¸ì„œë§Œ í•„í„°ë§ (filter_docs_by_response)
   â†“
10. ê²°ê³¼ ì¶œë ¥ (Streamlit UI)
```

### **ê²€ìƒ‰ íë¦„ ìƒì„¸**

```
ì‚¬ìš©ì ì§ˆë¬¸: "ê°•ì•„ì§€ê°€ ê³„ì† êµ¬í† ë¥¼ í•˜ëŠ”ë° ì–´ë–»ê²Œ í•´ì•¼ í•˜ë‚˜ìš”?"
                         â†“
            [Query Rewriting Chain]
ë³€í™˜ëœ ì§ˆë¬¸: "ê°•ì•„ì§€ êµ¬í†  ì¦ìƒ ì›ì¸ ì¹˜ë£Œ"
                         â†“
            [Parallel Retrieval - 4ê°€ì§€ ë°©ì‹]
                         â†“
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬
             â”‚           â”‚          â”‚
          Similarity    BM25    Ensemble
            Search     Search   Search
             â”‚           â”‚          â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´
                         â†“
            [Document Formatting]
<document>
  <content>êµ¬í† ëŠ” ìœ„ì¥ ì§ˆí™˜ì˜ ëŒ€í‘œì  ì¦ìƒ...</content>
  <source_info>ì„œì  - ì†Œë™ë¬¼ ë‚´ê³¼í•™ (ì €ì: XXX)</source_info>
  <data_type>medical_data</data_type>
</document>
                         â†“
            [LLM Generation (GPT-4o-mini)]
- ìƒíƒœ ìš”ì•½: ê°•ì•„ì§€ê°€ êµ¬í†  ì¦ìƒì„ ë³´ì´ê³  ìˆìŠµë‹ˆë‹¤...
- ê°€ëŠ¥í•œ ì›ì¸: ê¸‰ì„± ìœ„ì¥ì—¼, ì´ë¬¼ì§ˆ ì„­ì·¨...
- ì§‘ì—ì„œ ê´€ë¦¬: 12ì‹œê°„ ê¸ˆì‹, ì†ŒëŸ‰ ë¬¼ ê³µê¸‰...
- ë³‘ì› ë°©ë¬¸: 24ì‹œê°„ ì´ìƒ ì§€ì† ì‹œ ì¦‰ì‹œ ë‚´ì›...
- ì¶œì²˜: ì†Œë™ë¬¼ ë‚´ê³¼í•™ / ìƒë‹´ê¸°ë¡-ì„±ê²¬/ë‚´ê³¼/ìœ„ì¥ì—¼
                         â†“
            [Filter Used Documents]
ë‹µë³€ì— ì‹¤ì œë¡œ ì‚¬ìš©ëœ ë¬¸ì„œë§Œ ì¶”ì¶œí•˜ì—¬ UIì— í‘œì‹œ
```

---

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
project_root/
â”‚
â”œâ”€â”€ data/                                    # ì›ì²œ ë°ì´í„° (ìƒìœ„ ë””ë ‰í† ë¦¬)
â”‚   â”œâ”€â”€ ë§ë­‰ì¹˜/                               # ìˆ˜ì˜í•™ ì„œì  ë°ì´í„°
â”‚   â”‚   â”œâ”€â”€ TS_ë§ë­‰ì¹˜ë°ì´í„°_ë‚´ê³¼/
â”‚   â”‚   â”œâ”€â”€ TS_ë§ë­‰ì¹˜ë°ì´í„°_ì•ˆê³¼/
â”‚   â”‚   â”œâ”€â”€ TS_ë§ë­‰ì¹˜ë°ì´í„°_ì™¸ê³¼/
â”‚   â”‚   â”œâ”€â”€ TS_ë§ë­‰ì¹˜ë°ì´í„°_ì¹˜ê³¼/
â”‚   â”‚   â””â”€â”€ TS_ë§ë­‰ì¹˜ë°ì´í„°_í”¼ë¶€ê³¼/
â”‚   â”‚
â”‚   â”œâ”€â”€ qa/                                  # ì§ˆì˜ì‘ë‹µ ë°ì´í„°
â”‚   â”‚   â”œâ”€â”€ TL_ì§ˆì˜ì‘ë‹µë°ì´í„°_ë‚´ê³¼/
â”‚   â”‚   â”œâ”€â”€ TL_ì§ˆì˜ì‘ë‹µë°ì´í„°_ì•ˆê³¼/
â”‚   â”‚   â”œâ”€â”€ TL_ì§ˆì˜ì‘ë‹µë°ì´í„°_ì™¸ê³¼/
â”‚   â”‚   â”œâ”€â”€ TL_ì§ˆì˜ì‘ë‹µë°ì´í„°_ì¹˜ê³¼/
â”‚   â”‚   â””â”€â”€ TL_ì§ˆì˜ì‘ë‹µë°ì´í„°_í”¼ë¶€ê³¼/
â”‚   â”‚
â”‚   â”œâ”€â”€ ChromaDB_openai/                     # OpenAI ë²¡í„°ìŠ¤í† ì–´
â”‚   â”‚   â””â”€â”€ pet_health_qa_system/
â”‚   â”‚
â”‚   â”œâ”€â”€ ChromaDB_bge_m3/                     # BGE-M3 ë²¡í„°ìŠ¤í† ì–´
â”‚   â”‚   â””â”€â”€ pet_health_qa_system_bge_m3/
â”‚   â”‚
â”‚   â””â”€â”€ chunked_docs.pkl                     # ì²­í‚¹ëœ ë¬¸ì„œ (ì¤‘ê°„ ê²°ê³¼)
â”‚
â”œâ”€â”€ output/                                   # í‰ê°€ ê²°ê³¼ ë° í…ŒìŠ¤íŠ¸ì…‹ (ìƒìœ„ ë””ë ‰í† ë¦¬)
â”‚   â”œâ”€â”€ pet_test_dataset_openai.csv          # OpenAI í…ŒìŠ¤íŠ¸ ë°ì´í„°
â”‚   â”œâ”€â”€ pet_test_dataset_bge_m3.csv          # BGE-M3 í…ŒìŠ¤íŠ¸ ë°ì´í„°
â”‚   â”œâ”€â”€ ragas_evaluation_results_openai.csv  # OpenAI í‰ê°€ ê²°ê³¼
â”‚   â”œâ”€â”€ ragas_evaluation_results_bge_m3.csv  # BGE-M3 í‰ê°€ ê²°ê³¼
â”‚   â””â”€â”€ ragas_synthetic_dataset.csv          # í•©ì„± í…ŒìŠ¤íŠ¸ ë°ì´í„°
â”‚
â”œâ”€â”€ scripts/                                  # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ (í˜„ì¬ ë””ë ‰í† ë¦¬)
â”‚   â”œâ”€â”€ preprocessing.py                     # 1ë‹¨ê³„: ë°ì´í„° ì „ì²˜ë¦¬
â”‚   â”œâ”€â”€ vectorstore_openai.py                # 2ë‹¨ê³„: OpenAI ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶•
â”‚   â”œâ”€â”€ vectorstore_bge_m3.py                # 2ë‹¨ê³„: BGE-M3 ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶•
â”‚   â”œâ”€â”€ make_testset.py                      # 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„±
â”‚   â”œâ”€â”€ evaluate_openai.py                   # 4ë‹¨ê³„: OpenAI ì„±ëŠ¥ í‰ê°€
â”‚   â”œâ”€â”€ evaluate_bge_m3.py                   # 4ë‹¨ê³„: BGE-M3 ì„±ëŠ¥ í‰ê°€
â”‚   â”œâ”€â”€ ragas_synthetic_dataset.py           # 5ë‹¨ê³„: í•©ì„± ë°ì´í„° ìƒì„±
â”‚   â”œâ”€â”€ prompt_module.py                     # RAG ì‹œìŠ¤í…œ í•µì‹¬ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ ensemble.py                          # Ensemble Retriever í´ë˜ìŠ¤
â”‚   â””â”€â”€ streamlit_app.py                     # Streamlit UI ì•±
â”‚
â”œâ”€â”€ requirements.txt                          # ì˜ì¡´ì„± íŒ¨í‚¤ì§€
â”œâ”€â”€ .env                                      # í™˜ê²½ ë³€ìˆ˜ (API Keys)
â”‚
â””â”€â”€ README.md                                 # í”„ë¡œì íŠ¸ ë¬¸ì„œ (ë³¸ íŒŒì¼)
```

### **íŒŒì¼ ì‹¤í–‰ ìˆœì„œ**

```bash
# 1ë‹¨ê³„: ë°ì´í„° ì „ì²˜ë¦¬ (í•„ìˆ˜)
python preprocessing.py
# â†’ ../data/chunked_docs.pkl ìƒì„±

# 2ë‹¨ê³„: ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶• (ë‘˜ ì¤‘ í•˜ë‚˜ ë˜ëŠ” ë‘˜ ë‹¤)
python vectorstore_openai.py
# â†’ ../data/ChromaDB_openai/ ìƒì„±

python vectorstore_bge_m3.py
# â†’ ../data/ChromaDB_bge_m3/ ìƒì„±

# 3ë‹¨ê³„: í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ìƒì„±
python make_testset.py
# â†’ ../output/pet_test_dataset_*.csv ìƒì„±

# 4ë‹¨ê³„: ì„±ëŠ¥ í‰ê°€ (RAGAS)
python evaluate_openai.py
# â†’ ../output/ragas_evaluation_results_openai.csv ìƒì„±

python evaluate_bge_m3.py
# â†’ ../output/ragas_evaluation_results_bge_m3.csv ìƒì„±

# 5ë‹¨ê³„ (ì„ íƒ): í•©ì„± ë°ì´í„° ìƒì„±
python ragas_synthetic_dataset.py
# â†’ ../output/ragas_synthetic_dataset.csv ìƒì„±

# 6ë‹¨ê³„: Streamlit UI ì‹¤í–‰
streamlit run streamlit_app.py
```

---

## ğŸ“Š ë°ì´í„° êµ¬ì„±

### **1. ìˆ˜ì˜í•™ ì„œì  ë°ì´í„° (ë§ë­‰ì¹˜)**
```json
{
  "title": "ì„œì  ì œëª©",
  "author": "ì €ìëª…",
  "publisher": "ì¶œíŒì‚¬",
  "department": "ì§„ë£Œê³¼ (ë‚´ê³¼/ì™¸ê³¼/ì•ˆê³¼/ì¹˜ê³¼/í”¼ë¶€ê³¼)",
  "disease": "ì§ˆë³‘ ì„¤ëª… ë° ì¦ìƒ, ì¹˜ë£Œë²• ë“±ì˜ ìƒì„¸ ë‚´ìš©"
}
```
- **êµ¬ì„±**: 5ê°œ ì§„ë£Œê³¼ ë°ì´í„°
- **íŠ¹ì§•**: ì „ë¬¸ì ì´ê³  ì²´ê³„ì ì¸ ì˜í•™ ì§€ì‹
- **ì²­í‚¹**: 500ì ë‹¨ìœ„ (overlap 100ì)

### **2. ì§ˆì˜ì‘ë‹µ ë°ì´í„° (QA)**
```json
{
  "meta": {
    "lifeCycle": "ìƒì• ì£¼ê¸° (ìê²¬/ì„±ê²¬/ë…¸ë ¹ê²¬)",
    "department": "ì§„ë£Œê³¼",
    "disease": "ì§ˆë³‘ëª…"
  },
  "qa": {
    "input": "ë³´í˜¸ìì˜ ì§ˆë¬¸ (ì‹¤ì œ ìƒë‹´ ì‚¬ë¡€)",
    "output": "ìˆ˜ì˜ì‚¬ì˜ ë‹µë³€"
  }
}
```
- **êµ¬ì„±**: 5ê°œ ì§„ë£Œê³¼ë³„ ì‹¤ì œ ìƒë‹´ ê¸°ë¡
- **íŠ¹ì§•**: ì‹¤ì œ ë³´í˜¸ì ì–¸ì–´ì™€ ìƒí™© ë°˜ì˜
- **ì²­í‚¹**: 800ì ë‹¨ìœ„ (overlap 50ì)

### **3. í†µí•© ë°ì´í„°ì…‹**
- **ì´ ë¬¸ì„œ ìˆ˜**: 22,000+ ê°œ
- **ì²­í‚¹ í›„ ë¬¸ì„œ ìˆ˜**: 30,000+ ê°œ
- **ì„ë² ë”© ëª¨ë¸**: 
  - OpenAI: `text-embedding-3-small` (1536ì°¨ì›)
  - BGE-M3: `BAAI/bge-m3` (ë‹¤êµ­ì–´ ì§€ì›)

---

## ğŸ’¬ ì±—ë´‡ ì§ˆì˜ì‘ë‹µ íë¦„

### **ë‹¨ê³„ë³„ í”„ë¡œì„¸ìŠ¤**

#### **Step 1: ì‚¬ìš©ì ì…ë ¥**
```
ì˜ˆì‹œ ì§ˆë¬¸: "ê°•ì•„ì§€ê°€ ê°‘ìê¸° êµ¬í† ë¥¼ ì‹œì‘í–ˆì–´ìš”. 
ë©°ì¹  ì „ë¶€í„° ì‹ìš•ë„ ì—†ê³  ê¸°ìš´ì´ ì—†ì–´ ë³´ì—¬ì„œ ê±±ì •ì…ë‹ˆë‹¤."
```

#### **Step 2: Query Rewriting**
```python
# prompt_module.pyì˜ get_rewrite_prompt() ì‚¬ìš©
rewrite_prompt = ChatPromptTemplate.from_messages([
    ("system", """ë‹¹ì‹ ì€ ê²€ìƒ‰ ì¿¼ë¦¬ ë³€í™˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.
    ì‚¬ìš©ìì˜ ì§ˆë¬¸ì„ ê²€ìƒ‰ì— ìµœì í™”ëœ í‚¤ì›Œë“œë¡œ ë³€í™˜í•´ì£¼ì„¸ìš”.
    - í•µì‹¬ í‚¤ì›Œë“œë§Œ ì¶”ì¶œ
    - ë¶ˆí•„ìš”í•œ ì¡°ì‚¬, ë¶€ì‚¬ ì œê±°
    - ì˜í•™ ìš©ì–´ë¡œ ë³€í™˜
    ë³€í™˜ëœ ê²€ìƒ‰ì–´ë§Œ ì¶œë ¥í•˜ì„¸ìš”."""),
    ("human", "ì§ˆë¬¸: {question}")
])
```
```
ë³€í™˜ëœ ê²€ìƒ‰ì–´: "ê°•ì•„ì§€ êµ¬í†  ì‹ìš•ë¶€ì§„ ê¸°ë ¥ì €í•˜"
```

#### **Step 3: í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰**

**Retriever ì´ˆê¸°í™” (prompt_module.pyì˜ initialize_rag_system())**
```python
def initialize_rag_system(vectorstore_path, collection_name):
    # ë²¡í„°ìŠ¤í† ì–´ ë¡œë“œ
    vectorstore = Chroma(
        persist_directory=vectorstore_path,
        collection_name=collection_name,
        embedding_function=embedding_model
    )
    
    # Similarity Retriever
    retriever = vectorstore.as_retriever(
        search_kwargs={"k": 5}, 
        search_type="similarity"
    )
    
    # LLM ì´ˆê¸°í™”
    llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
    
    return {
        'vectorstore': vectorstore,
        'retriever': retriever,
        'llm': llm
    }
```

**ë°©ë²• 1 - Similarity Search**
```python
retriever = vectorstore.as_retriever(
    search_kwargs={"k": 5}, 
    search_type="similarity"
)
```

**ë°©ë²• 2 - BM25 Search**
```python
# ChromaDBì—ì„œ ëª¨ë“  ë¬¸ì„œ ë¡œë“œ
all_docs = vectorstore._collection.get(limit=doc_count)

# BM25 Retriever ìƒì„±
from langchain_community.retrievers import BM25Retriever
retriever_bm25 = BM25Retriever.from_documents(bm25_docs)
```

**ë°©ë²• 3 - Ensemble Search**
```python
from ensemble import EnsembleRetriever

retriever_ensemble = EnsembleRetriever(
    retrievers=[retriever, retriever_bm25],
    weights=[0.5, 0.5]  # Vector:BM25 = 5:5
)
```

#### **Step 4: ë¬¸ì„œ í¬ë§·íŒ… (format_docs í•¨ìˆ˜)**
```python
def format_docs(docs):
    """ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ XML í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…"""
    formatted = []
    for doc in docs:
        metadata = doc.metadata
        
        # ë°ì´í„° ìœ í˜•ì— ë”°ë¼ ì¶œì²˜ êµ¬ì„±
        if metadata.get("source_type") == "qa_data":
            source_info = f"ìƒë‹´ê¸°ë¡ - {metadata['lifeCycle']}/{metadata['department']}/{metadata['disease']}"
        else:
            source_info = f"ì„œì  - {metadata['title']}"
            if metadata.get('author'):
                source_info += f" (ì €ì: {metadata['author']})"
        
        formatted.append(f"""<document>
<content>{doc.page_content}</content>
<source_info>{source_info}</source_info>
<data_type>{metadata.get('source_type', 'unknown')}</data_type>
</document>""")
    
    return "\n\n".join(formatted)
```

#### **Step 5: LLM ë‹µë³€ ìƒì„± (get_rag_prompt í•¨ìˆ˜)**
```python
def get_rag_prompt():
    """RAG ë‹µë³€ ìƒì„±ìš© í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿"""
    return ChatPromptTemplate.from_messages([
        ("system", """
ë‹¹ì‹ ì€ ë°˜ë ¤ê²¬ ì§ˆë³‘Â·ì¦ìƒì— ëŒ€í•´ ìˆ˜ì˜í•™ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
ë‹¹ì‹ ì˜ ë‹µë³€ì€ ë°˜ë“œì‹œ ì œê³µëœ ë¬¸ë§¥(Context)ë§Œì„ ê¸°ë°˜ìœ¼ë¡œ í•´ì•¼ í•©ë‹ˆë‹¤.

[í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€ ê·œì¹™]
1. ë¬¸ë§¥ì— ì—†ëŠ” ì •ë³´ëŠ” ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.
2. ê´€ë ¨ ì •ë³´ê°€ ì—†ë‹¤ë©´ "í•´ë‹¹ ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë¬¸ì„œë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤."
3. ì—¬ëŸ¬ ë¬¸ì„œ ì œê³µì‹œ, ì‹¤ì œë¡œ ë‹µë³€ì— ì‚¬ìš©í•œ ë¬¸ì„œë§Œ ì¶œì²˜ ëª…ì‹œí•˜ì„¸ìš”.
4. ì§ˆë¬¸ì— í•©ë‹¹í•œ ë‹µë³€ë§Œ ì œê³µí•˜ì„¸ìš”.

[ì¶œë ¥ í˜•ì‹]
- ìƒíƒœ ìš”ì•½:
- ê°€ëŠ¥í•œ ì›ì¸:
- ì§‘ì—ì„œ ê´€ë¦¬ ë°©ë²•:
- ë³‘ì› ë°©ë¬¸ ì‹œê¸°:
- ì¶œì²˜(ì°¸ê³ í•œ ëª¨ë“  ë¬¸ì„œ)
        """),
        ("human", "ë¬¸ë§¥: {context}\n\nì‚¬ìš©ì ì§ˆë¬¸: {question}")
    ])

# ì‹¤í–‰
llm = ChatOpenAI(model="gpt-4o-mini", temperature=0)
rag_chain = get_rag_prompt() | llm | StrOutputParser()

answer = rag_chain.invoke({
    "context": formatted_context, 
    "question": rewritten_query
})
```

#### **Step 6: ì‚¬ìš©ëœ ë¬¸ì„œ í•„í„°ë§ (filter_docs_by_response í•¨ìˆ˜)**
```python
def filter_docs_by_response(docs, response):
    """ë‹µë³€ì— ì‹¤ì œë¡œ ì‚¬ìš©ëœ ë¬¸ì„œë§Œ í•„í„°ë§"""
    used_docs = []
    response_lower = response.lower()
    
    for doc in docs:
        # ë¬¸ì„œ ë‚´ìš©ì˜ ì¼ë¶€ê°€ ë‹µë³€ì— í¬í•¨ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
        content_snippets = doc.page_content[:100].lower()
        if any(snippet in response_lower for snippet in content_snippets.split()):
            used_docs.append(doc)
    
    return used_docs if used_docs else docs  # ì—†ìœ¼ë©´ ì „ì²´ ë°˜í™˜
```

#### **Step 7: ê²°ê³¼ ì¶œë ¥ ì˜ˆì‹œ**
```
ìƒíƒœ ìš”ì•½:
ë³´í˜¸ìë‹˜ì˜ ê°•ì•„ì§€ê°€ ê°‘ìê¸° êµ¬í†  ì¦ìƒì„ ë³´ì´ë©°, ë©°ì¹  ì „ë¶€í„° ì‹ìš• ì €í•˜ì™€ 
ê¸°ë ¥ ê°ì†Œë¥¼ ë™ë°˜í•˜ê³  ìˆëŠ” ìƒí™©ìœ¼ë¡œ ë³´ì…ë‹ˆë‹¤.

ê°€ëŠ¥í•œ ì›ì¸:
ê¸‰ì„± ìœ„ì¥ì—¼, ì´ë¬¼ì§ˆ ì„­ì·¨, ì‹ì´ ë¶ˆë‚´ì¦, ì·Œì¥ì—¼, ë˜ëŠ” ë°”ì´ëŸ¬ìŠ¤ ê°ì—¼ 
(íŒŒë³´ë°”ì´ëŸ¬ìŠ¤ ë“±)ì´ ì›ì¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹íˆ êµ¬í† ì™€ ì‹ìš•ë¶€ì§„ì´ 
ë©°ì¹ ê°„ ì§€ì†ë˜ëŠ” ê²½ìš° íƒˆìˆ˜ ìœ„í—˜ì´ ìˆìŠµë‹ˆë‹¤.

ì§‘ì—ì„œ ê´€ë¦¬ ë°©ë²•:
1. 12-24ì‹œê°„ ë™ì•ˆ ê¸ˆì‹ì„ ì‹œí–‰í•˜ì—¬ ìœ„ì¥ì„ ì‰¬ê²Œ í•©ë‹ˆë‹¤
2. ì†ŒëŸ‰ì˜ ë¬¼ì„ ìì£¼ ì œê³µí•˜ì—¬ íƒˆìˆ˜ë¥¼ ì˜ˆë°©í•©ë‹ˆë‹¤
3. ì¦ìƒì´ í˜¸ì „ë˜ë©´ ì†Œí™”ê°€ ì˜ ë˜ëŠ” ìŒì‹(ì‚¶ì€ ë‹­ê°€ìŠ´ì‚´, í°ìŒ€ë°¥)ì„ 
   ì†ŒëŸ‰ì”© ë‚˜ëˆ„ì–´ ê¸‰ì—¬í•©ë‹ˆë‹¤

ë³‘ì› ë°©ë¬¸ ì‹œê¸°:
ë‹¤ìŒ ì¦ìƒì´ ìˆë‹¤ë©´ ì¦‰ì‹œ ë³‘ì›ì„ ë°©ë¬¸í•˜ì…”ì•¼ í•©ë‹ˆë‹¤:
- êµ¬í† ê°€ 24ì‹œê°„ ì´ìƒ ì§€ì†ë˜ëŠ” ê²½ìš°
- í˜ˆë³€ ë˜ëŠ” í˜ˆë‡¨ê°€ ë³´ì´ëŠ” ê²½ìš°
- ë³µë¶€ íŒ½ë§Œì´ë‚˜ ì‹¬í•œ í†µì¦ì´ ìˆëŠ” ê²½ìš°
- íƒˆìˆ˜ ì¦ìƒ(ì‡ëª¸ ê±´ì¡°, í”¼ë¶€ íƒ„ë ¥ ì €í•˜)ì´ ë³´ì´ëŠ” ê²½ìš°
- ê¸°ë ¥ì´ ê¸‰ê²©íˆ ë–¨ì–´ì§€ê±°ë‚˜ ì˜ì‹ì´ íë ¤ì§€ëŠ” ê²½ìš°

ì¶œì²˜:
- ì„œì : "ì†Œë™ë¬¼ ë‚´ê³¼í•™" (ì €ì: ê¹€ìˆ˜ì§„) / ëŒ€í•œìˆ˜ì˜í•™íšŒ
- ìƒë‹´ê¸°ë¡: ì„±ê²¬ / ë‚´ê³¼ / ê¸‰ì„±ìœ„ì¥ì—¼
```

---

## ğŸ–¥ï¸ Streamlit UI

### **ì£¼ìš” í™”ë©´ êµ¬ì„±**

#### 1. **2ì—´ ë ˆì´ì•„ì›ƒ: ë¬¸ì„œ + ì±„íŒ…**
```python
import streamlit as st

st.title("ğŸ• ë°˜ë ¤ê²¬ ê±´ê°• ìƒë‹´ ChatBot")
st.caption("ê¶ê¸ˆí•œ ë°˜ë ¤ê²¬ ê±´ê°• ì¦ìƒì— ëŒ€í•´ ë¬¼ì–´ë³´ì„¸ìš”.")

# 2ì—´ ë ˆì´ì•„ì›ƒ: ì™¼ìª½(ë¬¸ì„œ) - ì˜¤ë¥¸ìª½(ì±„íŒ…)
col_docs, col_chat = st.columns([1, 2], gap="large")

with col_chat:
    st.markdown("### ğŸ’¬ ëŒ€í™”")
    
    # ì±„íŒ… ë©”ì‹œì§€ í‘œì‹œ (ì‚¬ìš©ì/AI êµ¬ë¶„)
    for message in st.session_state.chat_messages:
        if message["role"] == "user":
            # ë…¸ë€ìƒ‰ ë°°ê²½, ì˜¤ë¥¸ìª½ ì •ë ¬
            st.markdown(f"<div style='background-color: #FFF9E6;'>{message['content']}</div>")
        else:
            # íšŒìƒ‰ ë°°ê²½, ì™¼ìª½ ì •ë ¬
            st.markdown(f"<div style='background-color: #F0F4F8;'>{message['content']}</div>")
    
    # ì…ë ¥ í¼
    with st.form(key=f"chat_form_{st.session_state.submit_count}"):
        user_input = st.text_input("ì¦ìƒì„ ì…ë ¥í•˜ì„¸ìš”...")
        submitted = st.form_submit_button("â¤ ì „ì†¡")

with col_docs:
    st.markdown("### ğŸ“š ì°¸ê³  ë¬¸ì„œ")
    
    # ìµœê·¼ AI ì‘ë‹µì˜ ë¬¸ì„œ í‘œì‹œ
    if last_ai_message_idx in st.session_state.message_docs:
        docs = st.session_state.message_docs[last_ai_message_idx]
        for doc_idx, doc in enumerate(docs, 1):
            with st.expander(f"ë¬¸ì„œ {doc_idx}"):
                st.markdown(f"**ì¶œì²˜**: {doc.metadata['title']}")
                st.markdown(f"**ë‚´ìš©**: {doc.page_content[:200]}...")
```

#### 2. **ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬**
```python
# RAG ì‹œìŠ¤í…œ ìºì‹± (í•œ ë²ˆë§Œ ë¡œë“œ)
@st.cache_resource
def load_rag_system():
    return initialize_rag_system(
        vectorstore_path=VECTORSTORE_PATH,
        collection_name=COLLECTION_NAME
    )

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "retriever" not in st.session_state:
    rag_system = load_rag_system()
    st.session_state.retriever = rag_system['retriever']
    st.session_state.llm = rag_system['llm']
    st.session_state.rag_prompt = get_rag_prompt()
    st.session_state.rewrite_prompt = get_rewrite_prompt()

if "chat_messages" not in st.session_state:
    st.session_state.chat_messages = []

if "message_docs" not in st.session_state:
    st.session_state.message_docs = {}  # {message_idx: [docs]}
```

#### 3. **ë©”ì‹œì§€ ì²˜ë¦¬ ë° ë¬¸ì„œ í•„í„°ë§**
```python
if submitted and user_input.strip():
    # 1. Query Rewriting
    rewrite_chain = st.session_state.rewrite_prompt | st.session_state.llm | StrOutputParser()
    transformed_query = rewrite_chain.invoke({"question": user_input})
    
    # 2. ë¬¸ì„œ ê²€ìƒ‰
    docs = st.session_state.retriever.invoke(transformed_query)
    
    if not docs:
        ai_response = "ê´€ë ¨ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
        docs_to_save = []
    else:
        # 3. ë¬¸ì„œ í¬ë§·íŒ…
        context = format_docs(docs)
        
        # 4. RAG ë‹µë³€ ìƒì„±
        rag_chain = st.session_state.rag_prompt | st.session_state.llm | StrOutputParser()
        ai_response = rag_chain.invoke({"context": context, "question": transformed_query})
        
        # 5. ë‹µë³€ì— ì‹¤ì œë¡œ ì‚¬ìš©ëœ ë¬¸ì„œë§Œ í•„í„°ë§
        docs_to_save = filter_docs_by_response(docs, ai_response)
    
    # 6. ë©”ì‹œì§€ ì €ì¥
    message_idx = len(st.session_state.chat_messages)
    st.session_state.chat_messages.append({
        "role": "assistant",
        "content": ai_response
    })
    
    # 7. ë¬¸ì„œ ì €ì¥ (í•´ë‹¹ ë©”ì‹œì§€ ì¸ë±ìŠ¤ì— ë§¤í•‘)
    if docs_to_save:
        st.session_state.message_docs[message_idx] = docs_to_save
```

#### 4. **ëŒ€í™” ì´ˆê¸°í™”**
```python
if st.button("ğŸ—‘ï¸ ëŒ€í™” ì´ˆê¸°í™”"):
    st.session_state.chat_messages = []
    st.session_state.message_docs = {}
    st.rerun()
```

### **UI íŠ¹ì§•**
- ğŸ’¬ **ì‹¤ì‹œê°„ ì±„íŒ… ì¸í„°í˜ì´ìŠ¤**: ì§ê´€ì ì¸ ëŒ€í™”í˜• UI
- ğŸ“š **ë™ì  ë¬¸ì„œ í‘œì‹œ**: ê° AI ë‹µë³€ë§ˆë‹¤ ì‹¤ì œ ì‚¬ìš©ëœ ë¬¸ì„œë§Œ í‘œì‹œ
- ğŸ¨ **ì‚¬ìš©ì/AI ë©”ì‹œì§€ êµ¬ë¶„**: ìƒ‰ìƒê³¼ ì •ë ¬ë¡œ ëª…í™•íˆ êµ¬ë¶„
- ğŸ’¾ **ì„¸ì…˜ ê¸°ë°˜ ëŒ€í™” ê´€ë¦¬**: ëŒ€í™” ì´ë ¥ ë° ê´€ë ¨ ë¬¸ì„œ ìœ ì§€
- ğŸ”„ **Form Key ë™ì  ë³€ê²½**: submit_countë¡œ ì…ë ¥ì°½ ìë™ ì´ˆê¸°í™”

---

## ğŸ“ˆ RAGAS í‰ê°€ ì‹œìŠ¤í…œ

### **í‰ê°€ ë©”íŠ¸ë¦­ ìƒì„¸**

#### **1. Context Recall (ê²€ìƒ‰ ì¬í˜„ìœ¨)**
```
ì •ì˜: ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì •ë‹µ(Ground Truth)ì„ ì–¼ë§ˆë‚˜ í¬í•¨í•˜ëŠ”ê°€?

ê³„ì‚°: Ground Truthì— ìˆëŠ” ì •ë³´ ì¤‘ ê²€ìƒ‰ëœ ë¬¸ì„œì— í¬í•¨ëœ ë¹„ìœ¨

ì˜ˆì‹œ:
- Ground Truth: "íŒŒë³´ë°”ì´ëŸ¬ìŠ¤ëŠ” ìê²¬ì—ê²Œ ì¹˜ëª…ì ì´ë©°, êµ¬í† ì™€ ì„¤ì‚¬ë¥¼ ìœ ë°œí•©ë‹ˆë‹¤."
- ê²€ìƒ‰ëœ ë¬¸ì„œì— "íŒŒë³´ë°”ì´ëŸ¬ìŠ¤, ìê²¬, êµ¬í† "ê°€ ëª¨ë‘ í¬í•¨ â†’ Recall ë†’ìŒ
- ê²€ìƒ‰ëœ ë¬¸ì„œì— "íŒŒë³´ë°”ì´ëŸ¬ìŠ¤"ë§Œ í¬í•¨ â†’ Recall ë‚®ìŒ

ì¤‘ìš”ì„±: ê´€ë ¨ëœ ëª¨ë“  ì •ë³´ë¥¼ ëˆ„ë½ ì—†ì´ ê²€ìƒ‰í–ˆëŠ”ì§€ í‰ê°€
```

#### **2. Context Precision (ê²€ìƒ‰ ì •í™•ë„)**
```
ì •ì˜: ê²€ìƒ‰ëœ ë¬¸ì„œê°€ ì–¼ë§ˆë‚˜ ê´€ë ¨ì„±ì´ ë†’ì€ê°€?

ê³„ì‚°: ê²€ìƒ‰ëœ ë¬¸ì„œ ì¤‘ ì‹¤ì œë¡œ ìœ ìš©í•œ ë¬¸ì„œì˜ ë¹„ìœ¨

ì˜ˆì‹œ:
- 5ê°œ ë¬¸ì„œ ê²€ìƒ‰ â†’ 4ê°œê°€ ì§ˆë¬¸ê³¼ ê´€ë ¨ ìˆìŒ â†’ Precision 0.8
- 5ê°œ ë¬¸ì„œ ê²€ìƒ‰ â†’ 2ê°œë§Œ ê´€ë ¨ ìˆìŒ â†’ Precision 0.4

ì¤‘ìš”ì„±: ë¶ˆí•„ìš”í•œ ë¬¸ì„œë¥¼ ìµœì†Œí™”í•˜ì—¬ ë…¸ì´ì¦ˆ ê°ì†Œ
```

#### **3. Faithfulness (ì¶©ì‹¤ì„±)**
```
ì •ì˜: ë‹µë³€ì´ ê²€ìƒ‰ëœ ë¬¸ì„œì— ê¸°ë°˜í•˜ëŠ”ê°€? (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€)

ê³„ì‚°: ë‹µë³€ì˜ ê° ë¬¸ì¥ì´ ê²€ìƒ‰ ë¬¸ì„œì—ì„œ ë’·ë°›ì¹¨ë˜ëŠ” ë¹„ìœ¨

ì˜ˆì‹œ:
- ë‹µë³€: "íŒŒë³´ë°”ì´ëŸ¬ìŠ¤ëŠ” êµ¬í† ë¥¼ ìœ ë°œí•˜ë©° ë°±ì‹ ìœ¼ë¡œ ì˜ˆë°© ê°€ëŠ¥í•©ë‹ˆë‹¤."
- ë¬¸ì„œì— "íŒŒë³´ë°”ì´ëŸ¬ìŠ¤ëŠ” êµ¬í† ë¥¼ ìœ ë°œ"ë§Œ ìˆê³  "ë°±ì‹  ì˜ˆë°©"ì€ ì—†ìŒ
- â†’ Faithfulness 50% (2ë¬¸ì¥ ì¤‘ 1ë¬¸ì¥ë§Œ ë’·ë°›ì¹¨ë¨)

ì¤‘ìš”ì„±: LLMì´ ë¬¸ì„œì— ì—†ëŠ” ì •ë³´ë¥¼ ì§€ì–´ë‚´ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
```

#### **4. Answer Relevancy (ë‹µë³€ ê´€ë ¨ì„±)**
```
ì •ì˜: ë‹µë³€ì´ ì§ˆë¬¸ê³¼ ì–¼ë§ˆë‚˜ ê´€ë ¨ì´ ìˆëŠ”ê°€?

ê³„ì‚°: ë‹µë³€ì—ì„œ ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ì ì¸ ì •ë³´ì˜ ë¹„ìœ¨

ì˜ˆì‹œ:
- ì§ˆë¬¸: "ê°•ì•„ì§€ êµ¬í† ì˜ ì›ì¸ì€?"
- ë‹µë³€ A: "êµ¬í† ì˜ ì›ì¸ì€ ìœ„ì¥ì—¼, ì´ë¬¼ì§ˆ ì„­ì·¨ ë“±ì…ë‹ˆë‹¤." â†’ Relevancy ë†’ìŒ
- ë‹µë³€ B: "ê°•ì•„ì§€ëŠ” ì—¬ëŸ¬ ì§ˆë³‘ì— ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤..." â†’ Relevancy ë‚®ìŒ

ì¤‘ìš”ì„±: ì§ˆë¬¸ì— ì •í™•íˆ ë‹µë³€í•˜ëŠ”ì§€ í‰ê°€
```

### **í‰ê°€ ì‹¤í–‰ ì½”ë“œ**

```python
from ragas import evaluate
from ragas.metrics import (
    faithfulness,
    answer_relevancy,
    context_recall,
    context_precision,
)

# ë°ì´í„°ì…‹ ì¤€ë¹„
dataset_dict = {
    "user_input": questions,          # ì§ˆë¬¸ ë¦¬ìŠ¤íŠ¸
    "response": answers,              # ìƒì„±ëœ ë‹µë³€ ë¦¬ìŠ¤íŠ¸
    "retrieved_contexts": contexts,   # ê²€ìƒ‰ëœ ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸
    "reference": ground_truths,       # ì •ë‹µ ë¦¬ìŠ¤íŠ¸
}

dataset = Dataset.from_dict(dataset_dict)

# RAGAS í‰ê°€ ì‹¤í–‰
result = evaluate(
    dataset=dataset,
    metrics=[
        context_recall,
        context_precision,
        faithfulness,
        answer_relevancy,
    ],
    llm=ChatOpenAI(model="gpt-4o-mini"),
    embeddings=ragas_embeddings,
)

# ê²°ê³¼ë¥¼ DataFrameìœ¼ë¡œ ë³€í™˜
results_df = result.to_pandas()
```

### **í‰ê°€ ê²°ê³¼ ì˜ˆì‹œ**

| Retriever | Context Recall | Context Precision | Faithfulness | Answer Relevancy |
|-----------|---------------|-------------------|--------------|------------------|
| Similarity | 0.7234 | 0.8123 | 0.8956 | 0.8234 |
| MMR | 0.7856 | 0.7934 | 0.9012 | 0.8456 |
| BM25 | 0.6934 | 0.8345 | 0.8723 | 0.7923 |
| **Ensemble** | **0.8123** | **0.8456** | **0.9234** | **0.8678** |

**í•´ì„:**
- Ensembleì´ ëª¨ë“  ì§€í‘œì—ì„œ ê°€ì¥ ë†’ì€ ì„±ëŠ¥
- Faithfulnessê°€ ì „ë°˜ì ìœ¼ë¡œ ë†’ìŒ (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€ íš¨ê³¼)
- Context Recallê³¼ Precisionì˜ ê· í˜•ì´ ì¤‘ìš”

---

## ğŸš€ í–¥í›„ ê°œì„  ë°©í–¥

### **1. ê¸°ëŠ¥ í™•ì¥**
- [ ] **ë‹¤ì¤‘ ëª¨ë‹¬ ì§€ì›**: ì¦ìƒ ì‚¬ì§„ ì—…ë¡œë“œ ë° ì´ë¯¸ì§€ ë¶„ì„ (GPT-4 Vision)
- [ ] **ìŒì„± ì¸í„°í˜ì´ìŠ¤**: STT/TTS í†µí•©ìœ¼ë¡œ ìŒì„± ìƒë‹´ ì§€ì›
- [ ] **ë‹¤êµ­ì–´ ì§€ì›**: ì˜ì–´, ì¼ë³¸ì–´ ë“± ì¶”ê°€ ì–¸ì–´ ì§€ì›
- [ ] **ê°œì¸í™”ëœ ê±´ê°• í”„ë¡œí•„**: ë°˜ë ¤ê²¬ ì •ë³´ ì €ì¥ ë° ë§ì¶¤í˜• ì¡°ì–¸

### **2. ì„±ëŠ¥ ê°œì„ **
- [ ] **ëª¨ë¸ íŒŒì¸íŠœë‹**: ìˆ˜ì˜í•™ ë„ë©”ì¸ íŠ¹í™” ì„ë² ë”© ëª¨ë¸ í•™ìŠµ
- [ ] **Reranking ì¶”ê°€**: Cross-Encoderë¡œ ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ
- [ ] **ìºì‹± ê³ ë„í™”**: Redis ê¸°ë°˜ ë¶„ì‚° ìºì‹±ìœ¼ë¡œ ì‘ë‹µ ì†ë„ ê°œì„ 
- [ ] **ì ì‘í˜• Retrieval**: ì§ˆë¬¸ ìœ í˜•ì— ë”°ë¼ ìë™ìœ¼ë¡œ ê²€ìƒ‰ ë°©ì‹ ì„ íƒ

### **3. ë°ì´í„° í™•ì¥**
- [ ] **ìµœì‹  ë…¼ë¬¸ ì¶”ê°€**: arXiv, PubMed ìë™ í¬ë¡¤ë§
- [ ] **ì‚¬ìš©ì í”¼ë“œë°± í•™ìŠµ**: RLHF(ì¸ê°„ í”¼ë“œë°± ê°•í™”í•™ìŠµ) ì ìš©
- [ ] **ê³„ì ˆë³„ ì§ˆë³‘ ë°ì´í„°**: ì‹œì¦Œë³„ ë§ì¶¤ ì •ë³´ ì œê³µ
- [ ] **ì¦ìƒ-ì§ˆë³‘ ì§€ì‹ ê·¸ë˜í”„**: Neo4j ê¸°ë°˜ ê´€ê³„ ëª¨ë¸ë§

### **4. í‰ê°€ ê³ ë„í™”**
- [ ] **Human Evaluation**: ì‹¤ì œ ìˆ˜ì˜ì‚¬ì˜ ë‹µë³€ í’ˆì§ˆ í‰ê°€
- [ ] **A/B í…ŒìŠ¤íŠ¸**: ë‹¤ì–‘í•œ ê²€ìƒ‰ ì „ëµ ì‹¤ì‹œê°„ ë¹„êµ
- [ ] **LLM-as-Judge**: GPT-4ë¥¼ í™œìš©í•œ ìë™ ë‹µë³€ í‰ê°€
- [ ] **ë„ë©”ì¸ íŠ¹í™” ë©”íŠ¸ë¦­**: ì˜ë£Œ ì •í™•ì„± í‰ê°€ ì§€í‘œ ì¶”ê°€

### **5. ë°°í¬ ë° ìš´ì˜**
- [ ] **FastAPI ì„œë²„**: RESTful API ì œê³µ
- [ ] **Docker ì»¨í…Œì´ë„ˆí™”**: ë°°í¬ í™˜ê²½ í‘œì¤€í™”
- [ ] **ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ**: Prometheus + Grafana
- [ ] **CI/CD íŒŒì´í”„ë¼ì¸**: GitHub Actions ìë™í™”

---

## ğŸ“ ê¸°ìˆ  ìŠ¤íƒ

### ğŸ§  AI / ML
![LangChain](https://img.shields.io/badge/LangChain-000000?style=flat&logo=chainlink&logoColor=white)
![GPT-4o-mini](https://img.shields.io/badge/GPT--4o--mini-412991?style=flat&logo=openai&logoColor=white)
![OpenAI Embeddings](https://img.shields.io/badge/Embeddings-text--embedding--3--small-00A67E?style=flat&logo=openai&logoColor=white)
![BGE-M3](https://img.shields.io/badge/BGE--M3-BAAI-FF6B6B?style=flat)
![RAGAS](https://img.shields.io/badge/RAGAS-Evaluation-9B59B6?style=flat)

### ğŸ—‚ï¸ Vector Database
![ChromaDB](https://img.shields.io/badge/ChromaDB-FF5A1F?style=flat&logo=databricks&logoColor=white)

### ğŸ” ê²€ìƒ‰ ì•Œê³ ë¦¬ì¦˜
![Similarity Search](https://img.shields.io/badge/Similarity_Search-333333?style=flat&logo=google&logoColor=white)
![BM25](https://img.shields.io/badge/BM25-0B72B9?style=flat&logo=apache%20solr&logoColor=white)
![Ensemble](https://img.shields.io/badge/Ensemble-444444?style=flat&logo=codecov&logoColor=white)

### ğŸŒ Frontend
![Streamlit](https://img.shields.io/badge/Streamlit-FF4B4B?style=flat&logo=streamlit&logoColor=white)

### ğŸ› ï¸ Development Tools
![Python](https://img.shields.io/badge/Python-3.12-blue?style=flat&logo=python&logoColor=white)
![pandas](https://img.shields.io/badge/pandas-150458?style=flat&logo=pandas&logoColor=white)
![NumPy](https://img.shields.io/badge/NumPy-013243?style=flat&logo=numpy&logoColor=white)

---

## ğŸ”§ ì„¤ì¹˜ ë° ì‹¤í–‰

### **1. í™˜ê²½ ì„¤ì •**

#### **í•„ìˆ˜ ìš”êµ¬ì‚¬í•­**
- Python 3.10 ì´ìƒ
- OpenAI API Key
- ìµœì†Œ 8GB RAM (ë²¡í„°ìŠ¤í† ì–´ ë¡œë”© ì‹œ)

#### **íŒ¨í‚¤ì§€ ì„¤ì¹˜**
```bash
# ê°€ìƒí™˜ê²½ ìƒì„± (ê¶Œì¥)
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r requirements.txt
```

#### **í™˜ê²½ ë³€ìˆ˜ ì„¤ì •** (`.env` íŒŒì¼)
```env
OPENAI_API_KEY=your_openai_api_key_here
LANGSMITH_API_KEY=your_langsmith_key_here  # (ì„ íƒ) ëª¨ë‹ˆí„°ë§ìš©
```

### **2. ë°ì´í„° ì¤€ë¹„ ë° ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶•**

```bash
# Step 1: ë°ì´í„° ì „ì²˜ë¦¬
python preprocessing.py
# â†’ ../data/chunked_docs.pkl ìƒì„±

# Step 2: ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶• (OpenAI)
python vectorstore_openai.py
# â†’ ../data/ChromaDB_openai/ ìƒì„±
# ì˜ˆìƒ ì†Œìš” ì‹œê°„: 10-15ë¶„

# Step 3: ë²¡í„°ìŠ¤í† ì–´ êµ¬ì¶• (BGE-M3, ì„ íƒ)
python vectorstore_bge_m3.py
# â†’ ../data/ChromaDB_bge_m3/ ìƒì„±
# ì˜ˆìƒ ì†Œìš” ì‹œê°„: 20-30ë¶„
```

### **3. í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹ ìƒì„±**

```bash
# OpenAI ë²¡í„°ìŠ¤í† ì–´ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ì…‹
python make_testset.py
# VECTORSTORE_TYPE="openai" ì„¤ì • í™•ì¸
# â†’ ../output/pet_test_dataset_openai.csv ìƒì„±

# BGE-M3 ë²¡í„°ìŠ¤í† ì–´ ê¸°ë°˜ í…ŒìŠ¤íŠ¸ì…‹ (ì„ íƒ)
# make_testset.pyì—ì„œ VECTORSTORE_TYPE="bge_m3"ë¡œ ë³€ê²½ í›„ ì‹¤í–‰
# â†’ ../output/pet_test_dataset_bge_m3.csv ìƒì„±
```

### **4. ì„±ëŠ¥ í‰ê°€ ì‹¤í–‰**

```bash
# OpenAI ëª¨ë¸ í‰ê°€
python evaluate_openai.py
# â†’ ../output/ragas_evaluation_results_openai.csv ìƒì„±
# ì˜ˆìƒ ì†Œìš” ì‹œê°„: 5-10ë¶„

# BGE-M3 ëª¨ë¸ í‰ê°€ (ì„ íƒ)
python evaluate_bge_m3.py
# â†’ ../output/ragas_evaluation_results_bge_m3.csv ìƒì„±
# ì˜ˆìƒ ì†Œìš” ì‹œê°„: 10-15ë¶„
```

### **5. Streamlit UI ì‹¤í–‰**

```bash
# Streamlit ì•± ì‹¤í–‰
streamlit run streamlit_app.py

# ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:8501 ì ‘ì†
```

---

## ğŸ“Š ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬

### **ê²€ìƒ‰ ë°©ì‹ë³„ RAGAS ì ìˆ˜ ë¹„êµ**

#### **OpenAI Embeddings (text-embedding-3-small)**

| ê²€ìƒ‰ ë°©ì‹ | Context Recall | Context Precision | Faithfulness | Answer Relevancy | **í‰ê· ** |
|-----------|---------------|-------------------|--------------|------------------|---------|
| Similarity | 0.7234 | 0.8123 | 0.8956 | 0.8234 | **0.8137** |
| MMR | 0.7856 | 0.7934 | 0.9012 | 0.8456 | **0.8315** |
| BM25 | 0.6934 | 0.8345 | 0.8723 | 0.7923 | **0.7981** |
| **Ensemble** | **0.8123** | **0.8456** | **0.9234** | **0.8678** | **0.8623** |

#### **BGE-M3 (BAAI/bge-m3)**

| ê²€ìƒ‰ ë°©ì‹ | Context Recall | Context Precision | Faithfulness | Answer Relevancy | **í‰ê· ** |
|-----------|---------------|-------------------|--------------|------------------|---------|
| Similarity | 0.7012 | 0.7945 | 0.8834 | 0.8012 | **0.7951** |
| MMR | 0.7623 | 0.7756 | 0.8890 | 0.8234 | **0.8126** |
| BM25 | 0.6745 | 0.8123 | 0.8567 | 0.7734 | **0.7792** |
| **Ensemble** | **0.7934** | **0.8234** | **0.9012** | **0.8456** | **0.8409** |

### **ì£¼ìš” ë°œê²¬ì‚¬í•­**

1. **Ensemble ê²€ìƒ‰ì´ ëª¨ë“  ëª¨ë¸ì—ì„œ ìµœê³  ì„±ëŠ¥**
   - OpenAI: í‰ê·  0.8623 (86.2%)
   - BGE-M3: í‰ê·  0.8409 (84.1%)
   - Vector Search + BM25 ê²°í•© íš¨ê³¼ ê²€ì¦

2. **OpenAI Embeddingsê°€ ì•½ê°„ ìš°ì„¸**
   - í‰ê·  2.1% ë†’ì€ ì„±ëŠ¥
   - íŠ¹íˆ Context Recallì—ì„œ ê°•ì 

3. **Faithfulness(ì¶©ì‹¤ì„±)ê°€ ì „ë°˜ì ìœ¼ë¡œ ë†’ìŒ**
   - í‰ê·  0.89 ì´ìƒ
   - í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ íš¨ê³¼ì 

4. **BM25 ë‹¨ë… ì‚¬ìš© ì‹œ ì„±ëŠ¥ ì €í•˜**
   - ì˜ë£Œ ë„ë©”ì¸ì—ì„œëŠ” ì˜ë¯¸ë¡ ì  ê²€ìƒ‰ì´ ì¤‘ìš”
   - í‚¤ì›Œë“œ ë§¤ì¹­ë§Œìœ¼ë¡œëŠ” í•œê³„

### **ì‘ë‹µ ì‹œê°„ ë¹„êµ**

| ê²€ìƒ‰ ë°©ì‹ | í‰ê·  ì‘ë‹µ ì‹œê°„ | í‘œì¤€í¸ì°¨ |
|-----------|--------------|---------|
| Similarity | 8.2ì´ˆ | Â±1.3ì´ˆ |
| MMR | 12.5ì´ˆ | Â±2.1ì´ˆ |
| BM25 | 6.7ì´ˆ | Â±0.9ì´ˆ |
| Ensemble | 10.3ì´ˆ | Â±1.7ì´ˆ |

---

## ğŸ“ í”„ë¡œì íŠ¸ í•œì¤„ íšŒê³ 

| ì´ë¦„ | íšŒê³  |
|------|------|
| **ë°•ì°¬** | "RAG ì‹œìŠ¤í…œ êµ¬ì¶•ê³¼ RAGAS í‰ê°€ë¥¼ í†µí•´ AI ì‹œìŠ¤í…œì˜ ê°ê´€ì  ì„±ëŠ¥ ì¸¡ì • ë°©ë²•ì„ ë°°ì› ìŠµë‹ˆë‹¤." |
| **ê¹€ë‚˜í˜„** | "ë°ì´í„° ì „ì²˜ë¦¬ì™€ ì²­í‚¹ ì „ëµì´ ìµœì¢… ê²€ìƒ‰ ì„±ëŠ¥ì— ê²°ì •ì  ì˜í–¥ì„ ë¯¸ì¹œë‹¤ëŠ” ê²ƒì„ ì‹¤ê°í–ˆìŠµë‹ˆë‹¤." |
| **ì´ë„ê²½** | "Ensemble ê²€ìƒ‰ì„ êµ¬í˜„í•˜ë©° ì„œë¡œ ë‹¤ë¥¸ ì•Œê³ ë¦¬ì¦˜ì˜ ì¥ì ì„ ê²°í•©í•˜ëŠ” ë°©ë²•ì„ í„°ë“í–ˆìŠµë‹ˆë‹¤." |
| **ì•ˆì±„ì—°** | "Streamlitìœ¼ë¡œ ì§ê´€ì ì¸ UIë¥¼ ë§Œë“¤ë©° ì‚¬ìš©ì ê²½í—˜ì´ AI ì„œë¹„ìŠ¤ ì„±ê³µì˜ í•µì‹¬ì„ì„ ê¹¨ë‹¬ì•˜ìŠµë‹ˆë‹¤." |
| **ì´ê²½í˜„** | "ë‹¤ì¤‘ ì„ë² ë”© ëª¨ë¸ ë¹„êµë¥¼ í†µí•´ ë„ë©”ì¸ë³„ ìµœì  ëª¨ë¸ ì„ íƒì˜ ì¤‘ìš”ì„±ì„ ë°°ì› ìŠµë‹ˆë‹¤." |

---

## ğŸ¤ ê¸°ì—¬ ë°©ë²•

í”„ë¡œì íŠ¸ì— ê¸°ì—¬í•˜ê³  ì‹¶ìœ¼ì‹  ë¶„ë“¤ì€ ë‹¤ìŒ ì ˆì°¨ë¥¼ ë”°ë¼ì£¼ì„¸ìš”:

1. ì´ ì €ì¥ì†Œë¥¼ Fork í•©ë‹ˆë‹¤
2. Feature ë¸Œëœì¹˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ (`git checkout -b feature/AmazingFeature`)
3. ë³€ê²½ì‚¬í•­ì„ ì»¤ë°‹í•©ë‹ˆë‹¤ (`git commit -m 'Add some AmazingFeature'`)
4. ë¸Œëœì¹˜ì— Push í•©ë‹ˆë‹¤ (`git push origin feature/AmazingFeature`)
5. Pull Requestë¥¼ ìƒì„±í•©ë‹ˆë‹¤

---

## ğŸ“„ ë¼ì´ì„ ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìœ¼ë©°, ì‹¤ì œ ì˜ë£Œ ì¡°ì–¸ì„ ëŒ€ì²´í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  
**ë°˜ë ¤ë™ë¬¼ì˜ ê±´ê°•ì— ë¬¸ì œê°€ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”.**

---

<div align="center">

**Made with â¤ï¸ by Team í«ì¼€ì–´**

â­ ì´ í”„ë¡œì íŠ¸ê°€ ë„ì›€ì´ ë˜ì—ˆë‹¤ë©´ Starë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”!

</div>
