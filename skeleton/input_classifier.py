"""
Input Classifier Module
ì‚¬ìš©ì ì˜ë„ ë¶„ë¥˜

ì—­í• :
  - ì‚¬ìš©ì ì…ë ¥ ì¿¼ë¦¬ ë¶„ì„
  - ì˜ë„ë³„ ë¶„ë¥˜ (ì˜ë£Œ ìƒë‹´, ì§€ë„ ê²€ìƒ‰, ì¼ë°˜ ì§ˆë¬¸)
  - ë¶„ë¥˜ ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
"""

from typing import Tuple, Optional


def classify_query(query: str) -> str:
    """
    ì‚¬ìš©ì ì¿¼ë¦¬ë¥¼ ì˜ë„ì— ë”°ë¼ 3ê°€ì§€ ë¶„ë¥˜ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜
    
    Args:
        query (str): ì‚¬ìš©ìì˜ ì…ë ¥ ì¿¼ë¦¬
        
    Returns:
        str: ë¶„ë¥˜ ê²°ê³¼ (ë‹¤ìŒ ì¤‘ í•˜ë‚˜)
            - "medical_consultation": ì˜ë£Œ ìƒë‹´ (ì§ˆë³‘, ì¦ìƒ, ì¹˜ë£Œ ê´€ë ¨)
            - "map_search": ì§€ë„ ê²€ìƒ‰ (ë³‘ì›, ìœ„ì¹˜, ì£¼ì†Œ ê´€ë ¨)
            - "general": ì¼ë°˜ ì§ˆë¬¸ (ê¸°íƒ€)
    
    ë¶„ë¥˜ ê¸°ì¤€:
        A. Medical Consultation (ì˜ë£Œ ìƒë‹´)
           - í‚¤ì›Œë“œ: "ì¦ìƒ", "ì§ˆí™˜", "ë³‘", "ì¹˜ë£Œ", "ì•½", "ì•„íŒŒ", "í†µì¦" ë“±
           - ì˜ˆ: "ê°•ì•„ì§€ í”¼ë¶€ì—¼ì´ ë­ì˜ˆìš”?"
        
        B. Map Search (ì§€ë„ ê²€ìƒ‰)
           - í‚¤ì›Œë“œ: "ë³‘ì›", "ìœ„ì¹˜", "ì£¼ì†Œ", "ê·¼ì²˜", "ì°¾ì•„", "ì–´ë””" ë“±
           - ì˜ˆ: "ê·¼ì²˜ ë™ë¬¼ë³‘ì› ì°¾ì•„ì¤˜"
        
        C. General (ì¼ë°˜)
           - ìœ„ ë‘ ê°€ì§€ì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ì§ˆë¬¸
           - ì˜ˆ: "ë°˜ë ¤ë™ë¬¼ ë³´í—˜ì€?"
    
    ì²˜ë¦¬:
        1ï¸âƒ£  [í† í°í™”] ì¿¼ë¦¬ë¥¼ ë‹¨ì–´ë¡œ ë¶„í•´
        2ï¸âƒ£  [í‚¤ì›Œë“œ ë§¤ì¹­] ë¶„ë¥˜ë³„ í‚¤ì›Œë“œ ê²€ì‚¬
        3ï¸âƒ£  [ì ìˆ˜ ê³„ì‚°] ë¶„ë¥˜ë³„ ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
        4ï¸âƒ£  [ìµœì¢… ì„ íƒ] ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ë¶„ë¥˜ ë°˜í™˜
    
    TODO:
        - í‚¤ì›Œë“œ ê¸°ë°˜ ë¶„ë¥˜ êµ¬í˜„
        - (ì„ íƒ) LLM ê¸°ë°˜ ë¶„ë¥˜ë¡œ í™•ì¥
        - ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
    """
    # TODO: ë¶„ë¥˜ ë¡œì§
    # - medical_keywords = ["ì¦ìƒ", "ì§ˆí™˜", "ë³‘", "ì¹˜ë£Œ", ...]
    # - map_keywords = ["ë³‘ì›", "ìœ„ì¹˜", "ì£¼ì†Œ", "ê·¼ì²˜", ...]
    # - í‚¤ì›Œë“œ ë§¤ì¹­ ë° ì ìˆ˜ ê³„ì‚°
    
    # ë”ë¯¸ ë¶„ë¥˜ ë¡œì§: í‚¤ì›Œë“œ ê¸°ë°˜ ê°„ë‹¨í•œ íœ´ë¦¬ìŠ¤í‹±
    query_lower = query.lower()
    
    if any(kw in query_lower for kw in ["ì¦ìƒ", "ì§ˆí™˜", "ë³‘", "ì¹˜ë£Œ", "ì•½", "ì•„íŒŒ", "í†µì¦", "ì•½ë¬¼"]):
        result = "medical_consultation"
    elif any(kw in query_lower for kw in ["ë³‘ì›", "ìœ„ì¹˜", "ì£¼ì†Œ", "ê·¼ì²˜", "ì°¾ì•„", "ì–´ë””", "ì§€ë„", "ìœ„ì¹˜"]):
        result = "map_search"
    else:
        result = "general"
    
    print(f"âœ“ [classify_query] '{query}' â†’ {result}")
    return result


def classify_query_with_confidence(query: str) -> Tuple[str, float]:
    """
    ë¶„ë¥˜ ì‹ ë¢°ë„ ì ìˆ˜ì™€ í•¨ê»˜ ì¿¼ë¦¬ ë¶„ë¥˜
    
    Args:
        query (str): ì‚¬ìš©ì ì¿¼ë¦¬
        
    Returns:
        Tuple[str, float]: (ë¶„ë¥˜_ê²°ê³¼, ì‹ ë¢°ë„_ì ìˆ˜)
            ì‹ ë¢°ë„_ì ìˆ˜ëŠ” 0.0 ~ 1.0 (1.0ì´ ê°€ì¥ ë†’ìŒ)
    
    ì˜ˆì‹œ:
        ì…ë ¥: "ê°•ì•„ì§€ í”¼ë¶€ì—¼ ì¦ìƒì´ ë­ì˜ˆìš”?"
        ì¶œë ¥: ("medical_consultation", 0.95)
        
        ì…ë ¥: "ë°˜ë ¤ë™ë¬¼ ë³´í—˜ì€?"
        ì¶œë ¥: ("general", 0.60)
    
    TODO:
        - ê° ë¶„ë¥˜ë³„ ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
        - í‚¤ì›Œë“œ ë§¤ì¹­ ì ìˆ˜
        - LLM ê¸°ë°˜ ì‹ ë¢°ë„ (ì„ íƒ)
    """
    # TODO: ì‹ ë¢°ë„ ê³„ì‚° ë¡œì§
    
    classification = classify_query(query)
    confidence = 0.85  # ë”ë¯¸ ì‹ ë¢°ë„
    
    print(f"âœ“ [classify_query_with_confidence] {classification} (ì‹ ë¢°ë„: {confidence:.2%})")
    return classification, confidence


def get_classification_keywords() -> dict:
    """
    ë¶„ë¥˜ë³„ í‚¤ì›Œë“œ ì‚¬ì „ ë°˜í™˜
    
    Returns:
        dict: ë¶„ë¥˜ë³„ í‚¤ì›Œë“œ ë§¤í•‘
            {
                'medical_consultation': ['ì¦ìƒ', 'ì§ˆí™˜', ...],
                'map_search': ['ë³‘ì›', 'ìœ„ì¹˜', ...],
                'general': []
            }
    
    ìš©ë„:
        - ë¶„ë¥˜ ê¸°ì¤€ í™•ì¸
        - í‚¤ì›Œë“œ ì—…ë°ì´íŠ¸/ìˆ˜ì •
    
    TODO:
        - í‚¤ì›Œë“œ ì‚¬ì „ ê´€ë¦¬
        - ì‚¬ìš©ì ì •ì˜ í‚¤ì›Œë“œ ì¶”ê°€
    """
    keywords = {
        'medical_consultation': [
            'ì¦ìƒ', 'ì§ˆí™˜', 'ë³‘', 'ì¹˜ë£Œ', 'ì•½', 'ì•„íŒŒ', 'í†µì¦', 'ì•½ë¬¼',
            'ì§„ë£Œ', 'ìˆ˜ìˆ ', 'ì˜ˆë°©', 'ë°±ì‹ ', 'ë©´ì—­', 'ê°ì—¼', 'ì—¼ì¦'
        ],
        'map_search': [
            'ë³‘ì›', 'ìœ„ì¹˜', 'ì£¼ì†Œ', 'ê·¼ì²˜', 'ì°¾ì•„', 'ì–´ë””', 'ì§€ë„', 
            'ê±°ë¦¬', 'ê¸¸', 'ì£¼ë³€', 'ê°€ê¹Œìš´', 'ì˜ì—…ì‹œê°„'
        ],
        'general': []
    }
    
    print(f"âœ“ [get_classification_keywords] í‚¤ì›Œë“œ ì‚¬ì „ ë°˜í™˜")
    return keywords


# ==================== ì—”íŠ¸ë¦¬ í¬ì¸íŠ¸ ====================
if __name__ == "__main__":
    """
    í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ìŠ¤ì¼ˆë ˆí†¤ ë°ëª¨)
    """
    
    print("\n" + "="*60)
    print("ğŸ“Š Input Classifier Module - í…ŒìŠ¤íŠ¸")
    print("="*60 + "\n")
    
    # í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ë“¤
    test_queries = [
        "ê°•ì•„ì§€ í”¼ë¶€ ì§ˆí™˜ ì¦ìƒì´ ë­ì˜ˆìš”?",
        "ì„œìš¸ ê°•ë‚¨ì—­ ê·¼ì²˜ 24ì‹œê°„ ë™ë¬¼ë³‘ì› ì°¾ì•„ì¤˜",
        "ë°˜ë ¤ë™ë¬¼ ì˜ˆë°© ì ‘ì¢…ì€ ì–¸ì œ í•´ì•¼ í•˜ë‚˜ìš”?",
        "ë°˜ë ¤ë™ë¬¼ ë³´í—˜ì— ëŒ€í•´ ì•Œë ¤ì¤˜"
    ]
    
    print("### í…ŒìŠ¤íŠ¸ 1: ê¸°ë³¸ ë¶„ë¥˜ ###\n")
    for query in test_queries:
        result = classify_query(query)
        print(f"  '{query}'")
        print(f"  â†’ {result}\n")
    
    print("\n### í…ŒìŠ¤íŠ¸ 2: ì‹ ë¢°ë„ ì ìˆ˜ í¬í•¨ ###\n")
    for query in test_queries[:2]:
        result, confidence = classify_query_with_confidence(query)
        print(f"  '{query}'")
        print(f"  â†’ {result} ({confidence:.2%})\n")
    
    print("\n### í…ŒìŠ¤íŠ¸ 3: í‚¤ì›Œë“œ ì‚¬ì „ ###\n")
    keywords = get_classification_keywords()
    for category, kws in keywords.items():
        print(f"  {category}: {len(kws)}ê°œ í‚¤ì›Œë“œ")
        print(f"    {', '.join(kws[:5])}...\n")
    
    print("="*60)
    print("âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ!")
    print("="*60)
