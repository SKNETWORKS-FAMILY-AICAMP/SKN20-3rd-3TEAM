# 📌 반려동물 전문 고급 RAG 시스템 - 종합 요약

## 🎯 시스템 개요

반려동물 관련 질문을 **지능형으로 분류**하여 최적의 처리 방식을 적용하는 **고급 RAG 기반 어시스턴트 시스템**

---

## 🔑 핵심 기능

### 1️⃣ 질문 자동 분류 (3가지 유형)

| 유형 | 이름 | 처리 방식 | 예시 |
|------|------|---------|------|
| **A** | 의료 질문 | 내부 검색 → 근거 평가 → 웹 폴백 | "개의 피부염 증상?" |
| **B** | 병원 질문 | CSV 데이터 직접 조회 | "강남구 동물병원?" |
| **C** | 일반 질문 | LLM 직접 답변 | "반려동물 양육법?" |

---

### 2️⃣ 다층 검색 및 평가 시스템

```
Type A (의료)
├─ 내부 Chroma 검색 (5개 문서)
├─ LLM 기반 근거 평가
│  ├─ 직접성 (40%)
│  ├─ 신뢰도 (40%)
│  └─ 현재성 (20%)
├─ Threshold 판단 (0.6)
└─ 웹 검색 폴백 (필요시)

Type B (병원)
├─ 정규식 으로 지역/병원명 추출
├─ CSV 필터링
└─ 통계 제공

Type C (일반)
└─ LLM 직접 호출
```

---

### 3️⃣ 신뢰도 및 출처 명시

**모든 답변에 포함**:
- 📊 근거 점수 (0-100%)
- 🔗 출처 정보 (파일명, 부서)
- 📈 신뢰도 레벨
- 🌐 웹 검색 활용 여부

---

## 📂 프로젝트 구조

```
3rd/
├── src/
│   ├── question_classifier.py          ✨ 질문 분류 모듈
│   ├── medical_qa_handler.py           ✨ Type A 의료 질문
│   ├── hospital_handler.py             ✨ Type B 병원 질문
│   ├── advanced_rag_pipeline.py        ✨ 통합 파이프라인
│   ├── ingestion.py                    (기존)
│   ├── chunking.py                     (기존)
│   ├── embeddings.py                   (기존)
│   ├── retrieval.py                    (기존)
│   └── pipeline.py                     (기존)
│
├── advanced_main.py                    🚀 메인 실행 파일
├── test_advanced_rag.py                🧪 테스트 스크립트
│
├── data/
│   ├── raw/
│   │   ├── disease/                    📄 질병 정보 (215개 JSON)
│   │   └── hospital/                   🏥 병원 정보 (CSV)
│   └── Validation/
│       └── 01.원천데이터/             (학습 데이터)
│
├── chroma_db/                          🗃️ 벡터 데이터베이스
├── queries.txt                         📝 샘플 질문
│
├── ADVANCED_RAG_README.md              📖 상세 가이드
├── SYSTEM_ARCHITECTURE.md              🏗️ 아키텍처 설명
├── USAGE_GUIDE.md                      🎓 사용 방법
└── SYSTEM_SUMMARY.md                   📌 본 문서
```

---

## 🚀 빠른 시작

### 1. 설정
```bash
# .env 파일 생성
echo "OPENAI_API_KEY=sk-..." > .env

# 라이브러리 설치
pip install -r requirements.txt
```

### 2. 실행
```bash
python advanced_main.py
```

### 3. 메뉴 선택
```
1. 예시 질문 실행 (데모)
2. 대화형 모드 (실제 사용)
3. 배치 처리 (파일 기반)
4. 종료
```

---

## 💡 사용 예시

### 예시 1: 의료 질문
```
사용자: "개의 피부염 증상은 무엇인가요?"

시스템:
1. 분류 → Type A (의료)
2. 내부 검색 → 5개 문서
3. 근거 평가 → 0.85 (충분함)
4. 답변 생성

결과:
✅ 피부염의 증상, 원인, 치료법
✅ 근거 점수: 85%
✅ 출처: disease_001.json (피부과)
```

### 예시 2: 병원 질문
```
사용자: "강남구 동물병원을 찾아주세요."

시스템:
1. 분류 → Type B (병원)
2. CSV 필터링 → 87개 발견
3. 결과 정렬

결과:
✅ 강남구 상위 10개 병원
✅ 주소, 전화, 상태
✅ 통계 정보
```

### 예시 3: 일반 질문
```
사용자: "반려동물 첫 구매 체크리스트?"

시스템:
1. 분류 → Type C (일반)
2. LLM 답변

결과:
✅ 필수 물품 리스트
✅ 준비사항
✅ 예상 비용
```

---

## 🔧 주요 모듈 설명

### QuestionClassifier
- **역할**: 질문을 3가지 유형으로 분류
- **방식**: 2단계 분류 (키워드 → LLM)
- **출력**: (유형, 신뢰도, 사유)

### MedicalQAHandler
- **역할**: Type A 의료 질문 처리
- **특징**: 다층 검색, 근거 평가, 웹 폴백
- **출력**: 답변 + 근거 점수 + 출처

### HospitalHandler
- **역할**: Type B 병원 정보 제공
- **특징**: CSV 기반 위치 검색
- **출력**: 병원 목록 + 통계

### AdvancedRAGPipeline
- **역할**: 전체 시스템 통합
- **특징**: 유형별 처리 조율
- **출력**: 최종 답변 + 메타데이터

---

## 📊 성능 지표

| 항목 | 수치 |
|------|------|
| 의료 질문 처리 시간 | 5-10초 |
| 병원 검색 시간 | 1-2초 |
| 일반 질문 처리 시간 | 2-5초 |
| 내부 문서 수 | 3,000+ |
| 병원 데이터 | 5,287개 |
| 메모리 사용 | ~600MB |
| 임베딩 차원 | 1,536 |

---

## 🎓 결과 해석

### Type A 결과
```python
{
    'classification_type': 'MEDICAL',
    'classification_confidence': 0.92,  # 92% 신뢰
    'relevance_score': 0.85,            # 85% 근거 충분
    'internal_search_results': 5,
    'web_search_results': 0,
    'used_web_search': False,           # 웹 미사용
    'answer': '...',
    'sources': [...]                    # 출처 명시
}
```

**해석**: ✅ 높은 신뢰도, 충분한 내부 근거, 웹 검색 불필요

---

### Type B 결과
```python
{
    'classification_type': 'HOSPITAL',
    'hospitals': [                      # 87개 검색
        {'name': '강남동물병원',
         'address': '...',
         'phone': '...'}
    ],
    'statistics': {
        'total_hospitals': 5287,
        'top_districts': [...]
    }
}
```

**해석**: ✅ 효율적인 데이터 조회, 상세 정보 제공

---

### Type C 결과
```python
{
    'classification_type': 'GENERAL',
    'answer': '...',
    'sources': [],                      # 검증 없음
    'used_external_search': False
}
```

**해석**: ℹ️ LLM 기반 답변, 외부 검증 없음

---

## ⚠️ 주의사항

1. **의료 정보 면책**
   - 본 시스템의 답변은 참고만 하세요
   - 실제 진단/치료는 수의사 상담 필요

2. **데이터 최신성**
   - 병원 정보는 정기적 업데이트 필요
   - 질병 정보는 학습 데이터 기준

3. **API 비용**
   - OpenAI API 사용료 발생
   - 대량 처리시 비용 증가

4. **네트워크 의존**
   - LLM 호출시 인터넷 필요
   - 벡터스토어는 로컬 사용 가능

---

## 📈 확장 계획

### Phase 2 (단기)
- [ ] 멀티턴 대화 지원
- [ ] 사용자 피드백 학습
- [ ] 지도 시각화 (Kakao Maps)

### Phase 3 (중기)
- [ ] 다국어 지원
- [ ] 챗봇 UI (Streamlit)
- [ ] 모바일 앱

### Phase 4 (장기)
- [ ] 실시간 데이터 업데이트
- [ ] 사용자 개인화
- [ ] 예측 모델

---

## 🔍 트러블슈팅

| 문제 | 해결책 |
|------|--------|
| API 키 오류 | .env 파일 확인 |
| Chroma 없음 | advanced_main.py 메뉴 1번 실행 |
| 느린 속도 | 첫 실행은 정상, 캐싱 활용 |
| 부정확한 답변 | 웹 검색 활용, 내부 데이터 보강 |
| 병원 정보 오류 | CSV 데이터 갱신 필요 |

---

## 📚 문서 구조

| 문서 | 대상 | 내용 |
|------|------|------|
| ADVANCED_RAG_README.md | 개발자 | 전체 시스템 설명 |
| SYSTEM_ARCHITECTURE.md | 아키텍트 | 구조 및 플로우 |
| USAGE_GUIDE.md | 사용자 | 사용 방법 및 API |
| SYSTEM_SUMMARY.md | 매니저 | 본 문서 (개요) |

---

## 🎯 핵심 가치

✨ **지능형 분류** → 최적의 처리 방식 선택
✨ **다층 검증** → 신뢰할 수 있는 답변
✨ **출처 명시** → 투명성 확보
✨ **자동 폴백** → 부족한 정보 보충
✨ **통합 시스템** → 모든 유형의 질문 처리

---

## 💻 기술 스택

- **LLM**: OpenAI GPT-4o-mini
- **벡터 DB**: Chroma (SQLite 백엔드)
- **임베딩**: OpenAI text-embedding-3-small
- **프레임워크**: LangChain
- **데이터**: Pandas, JSON
- **언어**: Python 3.10+

---

## 📞 지원

더 자세한 정보는:
- 📖 ADVANCED_RAG_README.md 참조
- 🏗️ SYSTEM_ARCHITECTURE.md 참조
- 🎓 USAGE_GUIDE.md 참조

---

## ✅ 체크리스트

### 설정 시
- [ ] Python 3.10+ 설치
- [ ] 라이브러리 설치 완료
- [ ] API 키 설정 완료
- [ ] 데이터 파일 확인

### 첫 실행 시
- [ ] advanced_main.py 실행
- [ ] 메뉴 1번 (예시 실행) 선택
- [ ] Chroma 벡터스토어 생성 완료
- [ ] 테스트 결과 확인

### 운영 중
- [ ] 정기적 데이터 업데이트
- [ ] API 사용량 모니터링
- [ ] 사용자 피드백 수집
- [ ] 성능 메트릭 추적

---

**버전**: 2.0 (Advanced RAG)
**마지막 업데이트**: 2025년 12월 3일
**상태**: ✅ Production Ready

---

이 시스템은 반려동물 양육자들에게 **신뢰할 수 있는 의료 정보**, **효율적인 병원 검색**, **일반적인 양육 조언**을 제공합니다.

🐾 **반려동물 건강과 행복을 위해** 🐾

