# ðŸ“¦ ëª¨ë“ˆí™”ëœ RAG ì–´ì‹œìŠ¤í„´íŠ¸ - ìƒˆë¡œìš´ í´ë” êµ¬ì¡°

**ìž‘ì„±ì¼**: 2025-12-05  
**ìƒíƒœ**: âœ… ëª¨ë“ˆí™” ì™„ë£Œ

---

## ðŸŽ¯ ê°œìš”

ê¸°ì¡´ 8ê°œ ëª¨ë“ˆì„ **ê¸°ëŠ¥ë³„ í´ë” êµ¬ì¡°**ë¡œ ìž¬íŽ¸ì„±í•˜ì—¬ ë” ë‚˜ì€ ì±…ìž„ë¶„ë¦¬ì™€ ìœ ì§€ë³´ìˆ˜ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.

### ì´ì „ êµ¬ì¡° vs ìƒˆë¡œìš´ êµ¬ì¡°

#### ì´ì „ (í”Œëž« êµ¬ì¡°)
```
skeleton/
â”œâ”€â”€ data_processor.py
â”œâ”€â”€ vector_store_manager.py
â”œâ”€â”€ input_classifier.py
â”œâ”€â”€ rag_handler.py
â”œâ”€â”€ map_handler.py
â”œâ”€â”€ llm_generator.py
â”œâ”€â”€ evaluation_controller.py
â””â”€â”€ main.py
```

#### ìƒˆë¡œìš´ (ê³„ì¸µì  í´ë” êµ¬ì¡°)
```
skeleton/
â”œâ”€â”€ data_processing/          ðŸ“Š ë°ì´í„° ì²˜ë¦¬ ê³„ì¸µ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ data_processor.py       (ë¬¸ì„œ ì „ì²˜ë¦¬)
â”‚   â””â”€â”€ vector_store_manager.py (ë²¡í„° DB ê´€ë¦¬)
â”‚
â”œâ”€â”€ classification/            ðŸŽ¯ ìž…ë ¥ ë¶„ë¥˜ ê³„ì¸µ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ input_classifier.py     (ì˜ë„ ë¶„ë¥˜)
â”‚
â”œâ”€â”€ retrieval/                 ðŸ” ê²€ìƒ‰ ê³„ì¸µ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ rag_handler.py          (RAG ë° ì›¹ ê²€ìƒ‰)
â”‚   â””â”€â”€ map_handler.py          (ì§€ë„ ì •ë³´ ì²˜ë¦¬)
â”‚
â”œâ”€â”€ generation/                ðŸ¤– ì‘ë‹µ ìƒì„± ê³„ì¸µ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ llm_generator.py        (LLM ì‘ë‹µ ìƒì„±)
â”‚
â”œâ”€â”€ evaluation/                âš–ï¸ í‰ê°€ ê³„ì¸µ
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ evaluation_controller.py (ì‘ë‹µ í‰ê°€)
â”‚
â””â”€â”€ orchestration/             ðŸŽ¼ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ê³„ì¸µ
    â”œâ”€â”€ __init__.py
    â””â”€â”€ main_workflow.py        (í†µí•© ì›Œí¬í”Œë¡œìš°)
```

---

## ðŸ“ í´ë”ë³„ ì±…ìž„ (Responsibility)

### 1ï¸âƒ£ `data_processing/` - ë°ì´í„° ì²˜ë¦¬
**ì±…ìž„**: ë¬¸ì„œ ìž…ë ¥ â†’ ë²¡í„° DB ì €ìž¥

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `data_processor.py` | ë¬¸ì„œ ì „ì²˜ë¦¬ ë° ì²­í‚¹ | `preprocess_document()`, `chunk_text()`, `batch_preprocess_documents()` |
| `vector_store_manager.py` | ìž„ë² ë”© ë° ë²¡í„° DB | `VectorStoreManager`, `embed_and_index_chunks()`, `search_similar_chunks()` |

**ë°ì´í„° íë¦„**:
```
íŒŒì¼ â†’ [data_processor] â†’ ì²­í¬ â†’ [vector_store_manager] â†’ ë²¡í„° DB
```

---

### 2ï¸âƒ£ `classification/` - ìž…ë ¥ ë¶„ë¥˜
**ì±…ìž„**: ì‚¬ìš©ìž ì¿¼ë¦¬ ì˜ë„ ë¶„ë¥˜

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `input_classifier.py` | ì˜ë„ ë¶„ë¥˜ | `classify_query()`, `classify_query_with_confidence()` |

**ë¶„ë¥˜ ê²°ê³¼**:
- `"medical_consultation"`: ì˜ë£Œ ìƒë‹´
- `"map_search"`: ì§€ë„ ê²€ìƒ‰
- `"general"`: ì¼ë°˜ ì§ˆë¬¸

---

### 3ï¸âƒ£ `retrieval/` - ê²€ìƒ‰
**ì±…ìž„**: ì •ë³´ ê²€ìƒ‰ (RAG, ì›¹ ê²€ìƒ‰, ì§€ë„ API)

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `rag_handler.py` | RAG ë° ì›¹ ê²€ìƒ‰ | `perform_rag_search()`, `perform_web_search()`, `search_with_fallback()` |
| `map_handler.py` | ì§€ë„ ì •ë³´ ì²˜ë¦¬ | `get_map_info()`, `extract_location()`, `calculate_distance()` |

**ê²€ìƒ‰ íŒ¨í„´**:
```
ì¿¼ë¦¬ â†’ [rag_handler] â†’ RAG ê²€ìƒ‰
              â†“
         ê´€ë ¨ ë¬¸ì„œ ì—†ìŒ?
              â†“
         [ì›¹ ê²€ìƒ‰ìœ¼ë¡œ í´ë°±]
```

---

### 4ï¸âƒ£ `generation/` - ì‘ë‹µ ìƒì„±
**ì±…ìž„**: LLMì„ í†µí•œ ì‘ë‹µ ìƒì„± ë° ìµœì í™”

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `llm_generator.py` | LLM ì‘ë‹µ ìƒì„± | `generate_response()`, `rewrite_response()`, `estimate_token_count()` |

**ê¸°ëŠ¥**:
- í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§
- í† í° ê´€ë¦¬
- ì»¨í…ìŠ¤íŠ¸ ìµœì í™”

---

### 5ï¸âƒ£ `evaluation/` - í‰ê°€
**ì±…ìž„**: ì‘ë‹µ í’ˆì§ˆ í‰ê°€ ë° ì œì–´

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `evaluation_controller.py` | ì‘ë‹µ í‰ê°€ | `evaluate_response()`, `check_accuracy()`, `check_safety_guidelines()` |

**í‰ê°€ ì°¨ì›**:
- ì •í™•ë„ (Accuracy)
- ëª…í™•ì„± (Clarity)
- ì™„ì „ì„± (Completeness)
- ì•ˆì „ì„± (Safety)

**ì˜ì‚¬ê²°ì •**:
```
í‰ê·  ì ìˆ˜ >= 0.75  â†’ âœ… ACCEPT
0.50 ~ 0.75        â†’ ðŸ”„ REWRITE
< 0.50             â†’ âš ï¸ ESCALATE
```

---

### 6ï¸âƒ£ `orchestration/` - ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜
**ì±…ìž„**: 5ê°œ ê³„ì¸µì˜ í†µí•© ì›Œí¬í”Œë¡œìš°

| ëª¨ë“ˆ | ì—­í•  | ì£¼ìš” í•¨ìˆ˜ |
|------|------|---------|
| `main_workflow.py` | ì›Œí¬í”Œë¡œìš° | `main_workflow()`, `indexing_workflow()`, `batch_workflow()` |

**3ê°€ì§€ ì›Œí¬í”Œë¡œìš°**:
1. `indexing_workflow()`: ìƒ‰ì¸ êµ¬ì¶•
2. `main_workflow()`: ë‹¨ì¼ ì¿¼ë¦¬ ì²˜ë¦¬
3. `batch_workflow()`: ë°°ì¹˜ ì²˜ë¦¬

---

## ðŸ”„ ë°ì´í„° íë¦„ (Data Flow)

### ì „ì²´ ì²˜ë¦¬ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ì‚¬ìš©ìž ì¿¼ë¦¬ ìž…ë ¥               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  CLASSIFICATION    â”‚  (ë¶„ë¥˜ ê³„ì¸µ)
    â”‚  ì˜ë„ ë¶„ë¥˜         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚
    â–¼                 â–¼
medical/general    map_search
    â”‚                 â”‚
    â”‚                 â””â”€â”€â”€â”€â”€â”€â”
    â–¼                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   RETRIEVAL     â”‚  â”‚   RETRIEVAL     â”‚
â”‚  RAG ê²€ìƒ‰       â”‚  â”‚  ì§€ë„ API       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                    â”‚
         â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   GENERATION       â”‚  (ìƒì„± ê³„ì¸µ)
    â”‚  LLM ì‘ë‹µ ìƒì„±     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   EVALUATION       â”‚  (í‰ê°€ ê³„ì¸µ)
    â”‚  ì‘ë‹µ í’ˆì§ˆ í‰ê°€    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                â”‚
   PASS?          REWRITE?
     â”‚         (ìµœëŒ€ 2íšŒ)
     â”‚                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  âœ¨ ìµœì¢… ë‹µë³€ ë°˜í™˜  â”‚
     â”‚  + ë©”íŠ¸ë¦­ ìˆ˜ì§‘     â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ“¤ Import ë°©ë²•

### ê¸°ì¡´ ë°©ì‹ (í”Œëž« êµ¬ì¡°)
```python
from data_processor import preprocess_document
from vector_store_manager import embed_and_index_chunks
from input_classifier import classify_query
from rag_handler import search_with_fallback
```

### ìƒˆë¡œìš´ ë°©ì‹ (ëª¨ë“ˆí™” êµ¬ì¡°)
```python
# ë°©ì‹ 1: í´ë”ì—ì„œ ì§ì ‘ import
from data_processing import preprocess_document, embed_and_index_chunks
from classification import classify_query
from retrieval import search_with_fallback, get_map_info

# ë°©ì‹ 2: íŒ¨í‚¤ì§€ ê²½ë¡œ ì‚¬ìš©
from data_processing.data_processor import preprocess_document
from retrieval.rag_handler import search_with_fallback

# ë°©ì‹ 3: ì „ì²´ ì›Œí¬í”Œë¡œìš°
from orchestration import main_workflow, batch_workflow
```

---

## âœ… ëª¨ë“ˆí™”ì˜ ìž¥ì 

### 1. ì±…ìž„ ë¶„ë¦¬ (Separation of Concerns)
- ê° í´ë”ê°€ ëª…í™•í•œ ì±…ìž„ì„ ê°€ì§
- í•œ ê³„ì¸µì˜ ë³€ê²½ì´ ë‹¤ë¥¸ ê³„ì¸µì— ì˜í–¥ ìµœì†Œí™”

### 2. ê°€ë…ì„± í–¥ìƒ
- í´ë” êµ¬ì¡°ë§Œ ë´ë„ ì‹œìŠ¤í…œ ì´í•´ ìš©ì´
- íŠ¹ì • ê¸°ëŠ¥ì„ ì°¾ê¸° ì‰¬ì›€

### 3. ìœ ì§€ë³´ìˆ˜ì„± ê°œì„ 
- ëª¨ë“ˆ ê°„ ì˜ì¡´ì„±ì´ ëª…í™•
- ë²„ê·¸ ìˆ˜ì • ë° ê¸°ëŠ¥ ì¶”ê°€ê°€ ìš©ì´

### 4. í™•ìž¥ì„± ì¦ëŒ€
- ìƒˆë¡œìš´ ëª¨ë“ˆ ì¶”ê°€ ì‹œ ì ì ˆí•œ í´ë” ì„ íƒ ëª…í™•
- ê³„ì¸µ ì¶”ê°€ ê°€ëŠ¥

### 5. í…ŒìŠ¤íŠ¸ ìš©ì´ì„±
- ê° ê³„ì¸µì„ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
- ëª¨í‚¹/ìŠ¤í… êµ¬í˜„ ìš©ì´

---

## ðŸ”§ ì„¤ì • íŒŒì¼ (`__init__.py`)

ê° í´ë”ì˜ `__init__.py` íŒŒì¼ì€ **ê³µê°œ ì¸í„°íŽ˜ì´ìŠ¤(Public Interface)**ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

ì˜ˆ: `data_processing/__init__.py`
```python
from .data_processor import (
    preprocess_document,
    clean_text,
    chunk_text,
    extract_metadata,
    batch_preprocess_documents
)

from .vector_store_manager import (
    VectorStoreManager,
    embed_and_index_chunks
)

__all__ = [
    'preprocess_document',
    'clean_text',
    'chunk_text',
    'extract_metadata',
    'batch_preprocess_documents',
    'VectorStoreManager',
    'embed_and_index_chunks'
]
```

**ìž¥ì **:
- ì‚¬ìš©ìžëŠ” í´ë”ì—ì„œë§Œ import í•˜ë©´ ë¨
- ë‚´ë¶€ êµ¬í˜„ ë³€ê²½ ì‹œ ì™¸ë¶€ ì˜í–¥ ìµœì†Œí™”

---

## ðŸ“Š ê³„ì¸µ ê°„ ì˜ì¡´ì„±

```
            orchestration/
        (ë©”ì¸ ì›Œí¬í”Œë¡œìš°)
              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”
     â–¼        â–¼        â–¼
    data_  classif-  retrieval/
processing cation   
     â”‚        â”‚        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–¼
           generation/
          (ì‘ë‹µ ìƒì„±)
              â†“
           evaluation/
           (í‰ê°€)
```

**ì˜ì¡´ì„± ë°©í–¥**: ì•„ëž˜ â†’ ìœ„
- `orchestration/` ì€ ë‹¤ë¥¸ ëª¨ë“  ëª¨ë“ˆì— ì˜ì¡´
- `evaluation/` ì€ ë…ë¦½ì 
- ìˆœí™˜ ì˜ì¡´ì„± ì—†ìŒ

---

## ðŸš€ ì‚¬ìš© ì‹œìž‘í•˜ê¸°

### 1. ìƒ‰ì¸ êµ¬ì¶•
```python
from orchestration import indexing_workflow

files = ["data/disease/001.json", "data/disease/002.json"]
success = indexing_workflow(files)
```

### 2. ë‹¨ì¼ ì¿¼ë¦¬ ì²˜ë¦¬
```python
from orchestration import main_workflow

query = "ê°•ì•„ì§€ í”¼ë¶€ì—¼ ì¦ìƒ?"
response = main_workflow(query)
print(response)
```

### 3. ë°°ì¹˜ ì²˜ë¦¬
```python
from orchestration import batch_workflow

queries = ["ê°•ì•„ì§€ í”¼ë¶€ì—¼?", "ê·¼ì²˜ ë³‘ì›?", "ì˜ˆë°© ì ‘ì¢…?"]
results = batch_workflow(queries)
```

---

## ðŸ“ TODO: ì¶”ê°€ ê°œì„  ì‚¬í•­

- [ ] ê³µìœ  ìœ í‹¸ë¦¬í‹° í´ë” ì¶”ê°€ (`shared/`)
- [ ] ì„¤ì • ê´€ë¦¬ í´ë” ì¶”ê°€ (`config/`)
- [ ] ê° ê³„ì¸µë³„ í…ŒìŠ¤íŠ¸ ì½”ë“œ í´ë”
- [ ] ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ê°œì„ 
- [ ] ìºì‹± ì‹œìŠ¤í…œ ì¶”ê°€

---

## âœ¨ ê²°ë¡ 

ìƒˆë¡œìš´ ëª¨ë“ˆí™” êµ¬ì¡°ëŠ”:

âœ… **ëª…í™•í•œ ì±…ìž„ ë¶„ë¦¬**  
âœ… **í–¥ìƒëœ ê°€ë…ì„±**  
âœ… **ì‰¬ìš´ ìœ ì§€ë³´ìˆ˜**  
âœ… **í™•ìž¥ì„± ì¦ëŒ€**  
âœ… **í…ŒìŠ¤íŠ¸ ìš©ì´**

í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ í™•ìž¥ ê°€ëŠ¥í•œ RAG ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê¸° ìœ„í•œ ìµœì ì˜ êµ¬ì¡°ìž…ë‹ˆë‹¤.

---

**ìž‘ì„±ìž**: AI Assistant  
**ì™„ì„±ì¼**: 2025-12-05  
**ë²„ì „**: 1.0 (ëª¨ë“ˆí™” ì™„ë£Œ)  
**ìƒíƒœ**: âœ… ì œì¶œ ê°€ëŠ¥

