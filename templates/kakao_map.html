<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ì¹´ì¹´ì˜¤ ì§€ë„ API ì‚¬ìš© ì˜ˆì‹œ</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Malgun Gothic', sans-serif;
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        #map {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        
        .info-panel {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .button-group {
            margin-top: 15px;
            text-align: center;
        }
        
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 14px;
            background-color: #FEE500;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #FDD835;
        }
        
        .search-box {
            margin-top: 15px;
            text-align: center;
        }
        
        input[type="text"] {
            padding: 10px;
            width: 300px;
            font-size: 14px;
            border: 2px solid #ddd;
            border-radius: 5px;
        }
        
        #result {
            margin-top: 10px;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            min-height: 50px;
        }
    </style>
</head>
<body>
    <h1>ğŸ—ºï¸ ì¹´ì¹´ì˜¤ ì§€ë„ API ì˜ˆì‹œ (.env ì‚¬ìš©)</h1>
    
    <div id="map"></div>
    
    <div class="info-panel">
        <h3>ğŸ“ í˜„ì¬ ìœ„ì¹˜ ì •ë³´</h3>
        <div id="result">
            ì§€ë„ë¥¼ í´ë¦­í•˜ê±°ë‚˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.
        </div>
    </div>
    
    <div class="button-group">
        <button onclick="setCenter()">ì„œìš¸ì‹œì²­ìœ¼ë¡œ ì´ë™</button>
        <button onclick="setBounds()">í•œêµ­ ì „ì²´ ë³´ê¸°</button>
        <button onclick="setZoomIn()">í™•ëŒ€</button>
        <button onclick="setZoomOut()">ì¶•ì†Œ</button>
        <button onclick="getCurrentLocation()">ë‚´ ìœ„ì¹˜ ì°¾ê¸°</button>
    </div>
    
    <div class="search-box">
        <input type="text" id="keyword" placeholder="ì¥ì†Œë¥¼ ê²€ìƒ‰í•˜ì„¸ìš” (ì˜ˆ: ê°•ë‚¨ì—­)" onkeypress="if(event.keyCode==13) searchPlaces()">
        <button onclick="searchPlaces()">ê²€ìƒ‰</button>
    </div>

    <!-- ì¹´ì¹´ì˜¤ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ - .env íŒŒì¼ì˜ API í‚¤ ì‚¬ìš© -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ api_key }}&libraries=services&autoload=false"></script>
    
    <script>
        // API í‚¤ í™•ì¸
        console.log('API Key in HTML: {{ api_key }}');
        
        // âœ… .env íŒŒì¼ì˜ KAKAO_MAP_API_KEYê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!
        
        var map, marker;
        
        // SDK ë¡œë“œ ëŒ€ê¸°
        function initMap() {
            if (typeof kakao === 'undefined' || typeof kakao.maps === 'undefined') {
                setTimeout(initMap, 100);
                return;
            }
            
            kakao.maps.load(function() {
            var mapContainer = document.getElementById('map');
            var mapOption = {
                center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ì‹œì²­ ì¢Œí‘œ
                level: 3 // ì§€ë„ í™•ëŒ€ ë ˆë²¨
            };

            // ì§€ë„ ìƒì„±
            map = new kakao.maps.Map(mapContainer, mapOption);
            
            // ë§ˆì»¤ ìƒì„±
            marker = new kakao.maps.Marker({
                position: map.getCenter()
            });
            marker.setMap(map);
            
            // ì§€ë„ í´ë¦­ ì´ë²¤íŠ¸
            kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
                var latlng = mouseEvent.latLng;
                
                // ë§ˆì»¤ ìœ„ì¹˜ ë³€ê²½
                marker.setPosition(latlng);
                
                // ì¢Œí‘œë¥¼ ì£¼ì†Œë¡œ ë³€í™˜
                var geocoder = new kakao.maps.services.Geocoder();
                geocoder.coord2Address(latlng.getLng(), latlng.getLat(), function(result, status) {
                    if (status === kakao.maps.services.Status.OK) {
                        var address = result[0].address.address_name;
                        document.getElementById('result').innerHTML = 
                            `<strong>í´ë¦­í•œ ìœ„ì¹˜:</strong><br>
                            ì¢Œí‘œ: ${latlng.getLat().toFixed(6)}, ${latlng.getLng().toFixed(6)}<br>
                            ì£¼ì†Œ: ${address}`;
                    }
                });
            });
            
                // ì´ˆê¸° ìœ„ì¹˜ ì •ë³´ í‘œì‹œ
                document.getElementById('result').innerHTML = 
                    '<strong>ì„œìš¸íŠ¹ë³„ì‹œì²­</strong><br>ì¢Œí‘œ: 37.5665, 126.9780';
            });
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì§€ë„ ì´ˆê¸°í™”
        window.onload = initMap;
        
        // ì„œìš¸ì‹œì²­ìœ¼ë¡œ ì´ë™
        function setCenter() {
            var moveLatLon = new kakao.maps.LatLng(37.5665, 126.9780);
            map.setCenter(moveLatLon);
            marker.setPosition(moveLatLon);
            document.getElementById('result').innerHTML = 
                '<strong>ì„œìš¸íŠ¹ë³„ì‹œì²­</strong><br>ì¢Œí‘œ: 37.5665, 126.9780';
        }
        
        // í•œêµ­ ì „ì²´ ë³´ê¸°
        function setBounds() {
            var bounds = new kakao.maps.LatLngBounds(
                new kakao.maps.LatLng(33.0, 124.0),
                new kakao.maps.LatLng(38.6, 131.9)
            );
            map.setBounds(bounds);
        }
        
        // í™•ëŒ€
        function setZoomIn() {
            var level = map.getLevel();
            map.setLevel(level - 1);
        }
        
        // ì¶•ì†Œ
        function setZoomOut() {
            var level = map.getLevel();
            map.setLevel(level + 1);
        }
        
        // ë‚´ ìœ„ì¹˜ ì°¾ê¸°
        function getCurrentLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    var lat = position.coords.latitude;
                    var lon = position.coords.longitude;
                    var locPosition = new kakao.maps.LatLng(lat, lon);
                    
                    map.setCenter(locPosition);
                    marker.setPosition(locPosition);
                    
                    document.getElementById('result').innerHTML = 
                        `<strong>í˜„ì¬ ìœ„ì¹˜</strong><br>ì¢Œí‘œ: ${lat.toFixed(6)}, ${lon.toFixed(6)}`;
                });
            } else {
                alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
        
        // ì¥ì†Œ ê²€ìƒ‰
        function searchPlaces() {
            var keyword = document.getElementById('keyword').value;
            
            if (!keyword.trim()) {
                alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }
            
            var ps = new kakao.maps.services.Places();
            ps.keywordSearch(keyword, placesSearchCB);
        }
        
        // ê²€ìƒ‰ ê²°ê³¼ ì½œë°±
        function placesSearchCB(data, status, pagination) {
            if (status === kakao.maps.services.Status.OK) {
                var bounds = new kakao.maps.LatLngBounds();
                
                // ì²« ë²ˆì§¸ ê²°ê³¼ë¡œ ì´ë™
                var place = data[0];
                var coords = new kakao.maps.LatLng(place.y, place.x);
                
                marker.setPosition(coords);
                map.setCenter(coords);
                
                document.getElementById('result').innerHTML = 
                    `<strong>${place.place_name}</strong><br>
                    ì£¼ì†Œ: ${place.address_name}<br>
                    ì¢Œí‘œ: ${place.y}, ${place.x}`;
                    
            } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                alert('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
            } else if (status === kakao.maps.services.Status.ERROR) {
                alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }
    </script>
</body>
</html>
